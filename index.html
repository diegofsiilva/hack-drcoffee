<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AgroSOS - Assistente Agr√≠cola Inteligente</title>
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiQWdyb1NPUyIsInNob3J0X25hbWUiOiJBZ3JvU09TIiwic3RhcnRfdXJsIjoiLyIsImRpc3BsYXkiOiJzdGFuZGFsb25lIiwiYmFja2dyb3VuZF9jb2xvciI6IiMyMjc3M2QiLCJ0aGVtZV9jb2xvciI6IiMyMjc3M2QifQ==">
    <meta name="theme-color" content="#22773d">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 400px;
            margin: 0 auto;
            min-height: 100vh;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-left: 1px solid rgba(255, 255, 255, 0.1);
            border-right: 1px solid rgba(255, 255, 255, 0.1);
        }

        .header {
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .tagline {
            opacity: 0.9;
            font-size: 14px;
        }

        .stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            padding: 20px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 15px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(5px);
        }

        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #22c55e;
        }

        .stat-label {
            font-size: 12px;
            opacity: 0.8;
            margin-top: 5px;
        }

        .main-actions {
            padding: 20px;
        }

        .analyze-btn {
            width: 100%;
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
            border: none;
            border-radius: 15px;
            padding: 20px;
            color: white;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(34, 197, 94, 0.3);
            margin-bottom: 15px;
        }

        .analyze-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 35px rgba(34, 197, 94, 0.4);
        }

        .secondary-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .secondary-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            padding: 15px 10px;
            color: white;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .secondary-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-1px);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            border-radius: 20px;
            padding: 30px;
            max-width: 350px;
            width: 90%;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .camera-preview {
            width: 100%;
            height: 200px;
            background: #000;
            border-radius: 15px;
            margin: 20px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            position: relative;
            overflow: hidden;
        }

        .camera-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 150px;
            height: 150px;
            border: 3px solid #22c55e;
            border-radius: 15px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
            50% { opacity: 0.6; transform: translate(-50%, -50%) scale(1.05); }
            100% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .capture-btn {
            background: #22c55e;
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            color: white;
            font-size: 24px;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s ease;
        }

        .capture-btn:hover {
            transform: scale(1.1);
            background: #16a34a;
        }

        .close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            color: white;
            cursor: pointer;
            font-size: 18px;
        }

        .result-modal .modal-content {
            max-width: 380px;
            text-align: left;
        }

        .disease-info {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
        }

        .confidence {
            display: inline-block;
            background: #22c55e;
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            margin-top: 10px;
        }

        .treatment-section {
            margin-top: 20px;
        }

        .treatment-option {
            background: rgba(34, 197, 94, 0.2);
            border: 1px solid rgba(34, 197, 94, 0.4);
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
        }

        .price {
            color: #22c55e;
            font-weight: bold;
            font-size: 16px;
        }

        .community-section {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 15px;
            margin: 15px 0;
        }

        .community-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .community-item:last-child {
            border-bottom: none;
        }

        .distance {
            background: rgba(34, 197, 94, 0.3);
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 11px;
        }

        .loading {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #22c55e;
            animation: spin 1s ease-in-out infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .offline-indicator {
            background: #f59e0b;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 12px;
            margin: 10px 20px;
            text-align: center;
        }

        .map-container {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            height: 150px;
            margin: 15px 0;
            position: relative;
            overflow: hidden;
        }

        .map-pin {
            position: absolute;
            width: 12px;
            height: 12px;
            background: #ef4444;
            border-radius: 50%;
            animation: ping 2s infinite;
        }

        @keyframes ping {
            0% { transform: scale(1); opacity: 1; }
            75%, 100% { transform: scale(2); opacity: 0; }
        }

        .navigation {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 400px;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            display: flex;
            justify-content: space-around;
            padding: 15px 0;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            cursor: pointer;
            padding: 5px 15px;
            border-radius: 10px;
            transition: all 0.3s ease;
        }

        .nav-item:hover, .nav-item.active {
            background: rgba(34, 197, 94, 0.3);
        }

        .nav-icon {
            font-size: 20px;
        }

        .nav-label {
            font-size: 10px;
            opacity: 0.8;
        }

        .screen {
            display: none;
            padding: 20px;
            padding-bottom: 100px;
        }

        .screen.active {
            display: block;
        }

        .alert-item {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid rgba(239, 68, 68, 0.4);
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
        }

        .history-item {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .fade-in {
            animation: fadeIn 0.5s ease;
        }

        .bounce-in {
            animation: bounceIn 0.6s ease;
        }

        @keyframes bounceIn {
            0% { transform: scale(0.3); opacity: 0; }
            50% { transform: scale(1.05); }
            70% { transform: scale(0.9); }
            100% { transform: scale(1); opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="logo">
                <div class="logo-icon">üå±</div>
                <h1>AgroSOS</h1>
            </div>
            <div class="tagline">Seu assistente agr√≠cola inteligente</div>
        </div>

        <!-- Offline Indicator -->
        <div class="offline-indicator" id="offlineIndicator" style="display: none;">
            üì± Modo Offline Ativo - IA funcionando localmente
        </div>

        <!-- Home Screen -->
        <div class="screen active" id="homeScreen">
            <!-- Stats -->
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-number" id="analysisCount">1,247</div>
                    <div class="stat-label">An√°lises hoje</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">94%</div>
                    <div class="stat-label">Precis√£o da IA</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">R$ 150</div>
                    <div class="stat-label">Economia m√©dia</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="userCount">12.5K</div>
                    <div class="stat-label">Produtores ativos</div>
                </div>
            </div>

            <!-- Main Actions -->
            <div class="main-actions">
                <button class="analyze-btn" onclick="openCamera()">
                    üì∏ Analisar Planta
                </button>
                
                <div class="secondary-actions">
                    <button class="secondary-btn" onclick="showScreen('communityScreen')">
                        üó∫Ô∏è Mapa Regional
                    </button>
                    <button class="secondary-btn" onclick="showScreen('historyScreen')">
                        üìã Hist√≥rico
                    </button>
                </div>
            </div>

            <!-- Recent Alerts -->
            <div style="padding: 0 20px;">
                <h3 style="margin-bottom: 15px;">‚ö†Ô∏è Alertas na Regi√£o</h3>
                <div class="alert-item">
                    <strong>Ferrugem do Cafeeiro</strong><br>
                    <small>3 casos reportados em um raio de 5km</small>
                    <div class="distance">2.3km de dist√¢ncia</div>
                </div>
                <div class="alert-item">
                    <strong>Broca do Caf√©</strong><br>
                    <small>Surto ativo - 8 propriedades afetadas</small>
                    <div class="distance">4.7km de dist√¢ncia</div>
                </div>
            </div>
        </div>

        <!-- Community Screen -->
        <div class="screen" id="communityScreen">
            <h2 style="margin-bottom: 20px;">üåç Comunidade Regional</h2>
            
            <div class="map-container">
                <div class="map-pin" style="top: 20%; left: 30%;"></div>
                <div class="map-pin" style="top: 60%; left: 70%;"></div>
                <div class="map-pin" style="top: 40%; left: 45%;"></div>
                <div class="map-pin" style="top: 80%; left: 20%;"></div>
                <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: rgba(255,255,255,0.7);">
                    Regi√£o de Minas Gerais<br>
                    <small>4 surtos ativos detectados</small>
                </div>
            </div>

            <div class="community-section">
                <h4>Casos Recentes (√∫ltimas 24h)</h4>
                <div class="community-item">
                    <div>üî¥</div>
                    <div>
                        <strong>Jo√£o Silva</strong> - Ferrugem severa<br>
                        <small>Fazenda S√£o Jos√©</small>
                    </div>
                    <div class="distance">1.2km</div>
                </div>
                <div class="community-item">
                    <div>üü°</div>
                    <div>
                        <strong>Maria Santos</strong> - Cercosporiose<br>
                        <small>S√≠tio Boa Vista</small>
                    </div>
                    <div class="distance">3.5km</div>
                </div>
                <div class="community-item">
                    <div>üî¥</div>
                    <div>
                        <strong>Pedro Costa</strong> - Broca ativa<br>
                        <small>Fazenda Esperan√ßa</small>
                    </div>
                    <div class="distance">5.1km</div>
                </div>
            </div>
        </div>

        <!-- History Screen -->
        <div class="screen" id="historyScreen">
            <h2 style="margin-bottom: 20px;">üìã Seu Hist√≥rico</h2>
            
            <div class="history-item">
                <div>
                    <strong>Ferrugem do Cafeeiro</strong><br>
                    <small>Talh√£o 3 - Tratado com sucesso</small><br>
                    <small style="opacity: 0.7;">H√° 3 dias</small>
                </div>
                <div style="color: #22c55e;">‚úÖ</div>
            </div>
            
            <div class="history-item">
                <div>
                    <strong>Planta Saud√°vel</strong><br>
                    <small>Talh√£o 1 - Sem problemas detectados</small><br>
                    <small style="opacity: 0.7;">H√° 1 semana</small>
                </div>
                <div style="color: #22c55e;">‚úÖ</div>
            </div>
            
            <div class="history-item">
                <div>
                    <strong>Cercosporiose</strong><br>
                    <small>Talh√£o 2 - Em tratamento</small><br>
                    <small style="opacity: 0.7;">H√° 2 semanas</small>
                </div>
                <div style="color: #f59e0b;">üîÑ</div>
            </div>

            <div style="margin-top: 30px; text-align: center; opacity: 0.7;">
                <p>Economia total: <strong style="color: #22c55e;">R$ 450,00</strong></p>
                <p>Versus consultoria tradicional</p>
            </div>
        </div>

        <!-- Camera Choice Modal -->
        <div class="modal" id="cameraModal">
            <div class="modal-content">
                <button class="close-btn" onclick="closeModal()">&times;</button>
                <h3>üì∏ Analisar Planta</h3>
                <p>Escolha como fornecer a imagem da planta:</p>
                
                <div style="display: flex; flex-direction: column; gap: 15px; margin: 20px 0;">
                    <button class="capture-btn" onclick="openCameraStream()" style="width: 100%; border-radius: 10px; padding: 15px;">
                        üì∑ Usar C√¢mera
                    </button>
                    <button class="capture-btn" onclick="triggerFileUpload()" style="width: 100%; border-radius: 10px; padding: 15px;">
                        üì§ Fazer Upload
                    </button>
                </div>
                
                <!-- Hidden file input for uploads -->
                <input type="file" id="imageUpload" accept="image/*" style="display: none;" onchange="handleFileUpload(event)">
                
                <p style="font-size: 12px; opacity: 0.7; margin-top: 10px;">
                    Use uma imagem clara com boa ilumina√ß√£o
                </p>
            </div>
        </div>

        <!-- Camera Stream Modal -->
        <div class="modal" id="cameraStreamModal">
            <div class="modal-content">
                <button class="close-btn" onclick="closeModal()">&times;</button>
                <h3>üì∏ Fotografar Planta</h3>
                <p>Posicione a folha doente no centro da tela</p>
                
                <div class="camera-preview">
                    <video id="cameraVideo" autoplay playsinline style="width: 100%; height: 100%; object-fit: cover;"></video>
                    <canvas id="cameraCanvas" style="display: none;"></canvas>
                    <div class="camera-overlay"></div>
                </div>
                
                <button class="capture-btn" onclick="capturePhotoFromCamera()">üì∏</button>
                <p style="font-size: 12px; opacity: 0.7; margin-top: 10px;">
                    Certifique-se de que a ilumina√ß√£o est√° adequada
                </p>
            </div>
        </div>

        <!-- Analysis Modal -->
        <div class="modal" id="analysisModal">
            <div class="modal-content">
                <h3>ü§ñ Analisando...</h3>
                <div class="loading"></div>
                <p>Nossa IA est√° processando a imagem</p>
                <p style="font-size: 12px; opacity: 0.7;">Isso leva apenas alguns segundos</p>
            </div>
        </div>

        <!-- Result Modal -->
        <div class="modal result-modal" id="resultModal">
            <div class="modal-content">
                <button class="close-btn" onclick="closeModal()">&times;</button>
                <h3>üéØ Diagn√≥stico Completo</h3>
                
                <div class="disease-info">
                    <h4 id="diseaseName">Ferrugem do Cafeeiro</h4>
                    <div class="confidence" id="confidence">94% de confian√ßa</div>
                    <p style="margin-top: 10px; opacity: 0.9;" id="diseaseDescription">
                        Doen√ßa f√∫ngica comum em cafezais. Identificada pelas manchas alaranjadas caracter√≠sticas na parte inferior das folhas.
                    </p>
                </div>

                <div class="treatment-section">
                    <h4>üíä Tratamentos Recomendados</h4>
                    
                    <div class="treatment-option">
                        <strong>üè† Receita Caseira</strong>
                        <p>Calda bordalesa (sulfato de cobre + cal)</p>
                        <p class="price">Custo: R$ 8,50</p>
                    </div>
                    
                    <div class="treatment-option">
                        <strong>üß™ Tratamento Profissional</strong>
                        <p>Fungicida √† base de triazol</p>
                        <p class="price">Custo: R$ 45,00</p>
                    </div>
                </div>

                <div class="community-section">
                    <h4>üë• Outros Casos na Regi√£o</h4>
                    <div class="community-item">
                        <div>üìç</div>
                        <div>3 produtores relataram o mesmo problema</div>
                    </div>
                    <div class="community-item">
                        <div>‚è∞</div>
                        <div>√öltimos casos h√° 2 dias</div>
                    </div>
                </div>

                <button class="analyze-btn" onclick="closeModal()" style="margin-top: 20px;">
                    ‚úÖ Entendi, obrigado!
                </button>
            </div>
        </div>

        <!-- Navigation -->
        <div class="navigation">
            <div class="nav-item active" onclick="showScreen('homeScreen')">
                <div class="nav-icon">üè†</div>
                <div class="nav-label">In√≠cio</div>
            </div>
            <div class="nav-item" onclick="openCamera()">
                <div class="nav-icon">üì∏</div>
                <div class="nav-label">Analisar</div>
            </div>
            <div class="nav-item" onclick="showScreen('communityScreen')">
                <div class="nav-icon">üó∫Ô∏è</div>
                <div class="nav-label">Comunidade</div>
            </div>
            <div class="nav-item" onclick="showScreen('historyScreen')">
                <div class="nav-icon">üìã</div>
                <div class="nav-label">Hist√≥rico</div>
            </div>
        </div>
    </div>

    <script>
        // Simular dados din√¢micos
        let analysisCount = 1247;
        let userCount = 12500;

        // Atualizar contadores em tempo real
        setInterval(() => {
            analysisCount += Math.floor(Math.random() * 3);
            userCount += Math.floor(Math.random() * 2);
            
            document.getElementById('analysisCount').textContent = analysisCount.toLocaleString();
            document.getElementById('userCount').textContent = (userCount / 1000).toFixed(1) + 'K';
        }, 3000);

        // Detectar se est√° offline
        function updateOnlineStatus() {
            const indicator = document.getElementById('offlineIndicator');
            if (!navigator.onLine) {
                indicator.style.display = 'block';
            } else {
                indicator.style.display = 'none';
            }
        }

        window.addEventListener('online', updateOnlineStatus);
        window.addEventListener('offline', updateOnlineStatus);

        // Navega√ß√£o entre telas
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            
            document.getElementById(screenId).classList.add('active');
            
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            if (screenId === 'homeScreen') {
                document.querySelector('.nav-item').classList.add('active');
            }
        }

        // Abrir modal de escolha (c√¢mera ou upload)
        function openCamera() {
            document.getElementById('cameraModal').style.display = 'block';
            document.querySelector('#cameraModal .modal-content').classList.add('bounce-in');
        }

        // Abrir stream da c√¢mera
        async function openCameraStream() {
            closeModal();
            const video = document.getElementById('cameraVideo');
            
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { facingMode: 'environment' }
                });
                video.srcObject = stream;
                document.getElementById('cameraStreamModal').style.display = 'block';
                document.querySelector('#cameraStreamModal .modal-content').classList.add('bounce-in');
            } catch (error) {
                console.error('Erro ao acessar a c√¢mera:', error);
                alert('N√£o foi poss√≠vel acessar a c√¢mera. Tente fazer upload de uma imagem.');
                closeModal();
                openCamera();
            }
        }

        // Acionar input de upload
        function triggerFileUpload() {
            document.getElementById('imageUpload').click();
        }

        // Lidar com upload de arquivo
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (file) {
                closeModal();
                processImage(file);
            }
        }

        // Capturar foto da c√¢mera
        function capturePhotoFromCamera() {
            const video = document.getElementById('cameraVideo');
            const canvas = document.getElementById('cameraCanvas');
            const context = canvas.getContext('2d');
            
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            
            context.drawImage(video, 0, 0, canvas.width, canvas.height);
            
            canvas.toBlob(blob => {
                const stream = video.srcObject;
                stream.getTracks().forEach(track => track.stop());
                
                closeModal();
                processImage(blob);
            }, 'image/jpeg');
        }

        // Processar imagem (c√¢mera ou upload)
        function processImage(imageBlob) {
            document.getElementById('analysisModal').style.display = 'block';
            
            const processingTime = Math.random() * 3000 + 2000;
            
            setTimeout(() => {
                document.getElementById('analysisModal').style.display = 'none';
                
                const rand = Math.random();
                let selectedDisease;
                
                if (rand < 0.25) {
                    selectedDisease = diseaseDatabase[0];
                } else if (rand < 0.45) {
                    selectedDisease = diseaseDatabase[1];
                } else if (rand < 0.60) {
                    selectedDisease = diseaseDatabase[2];
                } else if (rand < 0.75) {
                    selectedDisease = diseaseDatabase[3];
                } else {
                    selectedDisease = diseaseDatabase[4];
                }
                
                const result = {
                    ...selectedDisease,
                    confidence: Math.floor(Math.random() * 15) + 85
                };
                
                showResult(result);
            }, processingTime);
        }

        // Mostrar resultado
        function showResult(result) {
            document.getElementById('diseaseName').textContent = result.name;
            document.getElementById('confidence').textContent = result.confidence + '% de confian√ßa';
            document.getElementById('diseaseDescription').textContent = result.description;
            
            const treatmentSection = document.querySelector('.treatment-section');
            const existingOptions = treatmentSection.querySelectorAll('.treatment-option');
            existingOptions.forEach(option => option.remove());
            
            result.treatments.forEach(treatment => {
                const treatmentDiv = document.createElement('div');
                treatmentDiv.className = 'treatment-option';
                treatmentDiv.innerHTML = `
                    <strong>${treatment.type}</strong>
                    <p>${treatment.name}</p>
                    <p class="price">Custo: ${treatment.cost}</p>
                `;
                treatmentSection.appendChild(treatmentDiv);
            });
            
            document.getElementById('resultModal').style.display = 'block';
            document.querySelector('#resultModal .modal-content').classList.add('bounce-in');
            
            addToHistory(result);
            
            analysisCount++;
            document.getElementById('analysisCount').textContent = analysisCount.toLocaleString();
            
            vibrate([100, 50, 100]);
            playSound('success');
        }

        // Adicionar ao hist√≥rico
        function addToHistory(result) {
            const historyData = JSON.parse(localStorage.getItem('agroSosHistory') || '[]');
            historyData.unshift({
                ...result,
                date: new Date().toISOString(),
                id: Date.now()
            });
            
            if (historyData.length > 10) {
                historyData.splice(10);
            }
            
            localStorage.setItem('agroSosHistory', JSON.stringify(historyData));
        }

        // Carregar hist√≥rico
        function loadHistory() {
            const historyData = JSON.parse(localStorage.getItem('agroSosHistory') || '[]');
            const historyScreen = document.getElementById('historyScreen');
            
            const oldItems = historyScreen.querySelectorAll('.history-item');
            oldItems.forEach(item => item.remove());
            
            const title = document.createElement('h2');
            title.textContent = 'üìã Seu Hist√≥rico';
            title.style.marginBottom = '20px';
            historyScreen.insertBefore(title, historyScreen.firstChild);
            
            if (historyData.length === 0) {
                const emptyDiv = document.createElement('div');
                emptyDiv.style.textAlign = 'center';
                emptyDiv.style.opacity = '0.7';
                emptyDiv.style.marginTop = '50px';
                emptyDiv.innerHTML = `
                    <p>üì± Nenhuma an√°lise ainda</p>
                    <p style="font-size: 14px; margin-top: 10px;">Comece fotografando uma planta!</p>
                `;
                historyScreen.appendChild(emptyDiv);
                return;
            }
            
            historyData.forEach(item => {
                const historyDiv = document.createElement('div');
                historyDiv.className = 'history-item';
                
                const date = new Date(item.date);
                const timeAgo = getTimeAgo(date);
                
                const status = item.name === 'Planta Saud√°vel' ? '‚úÖ' : 
                              item.confidence > 90 ? '‚úÖ' : 'üîÑ';
                
                historyDiv.innerHTML = `
                    <div>
                        <strong>${item.name}</strong><br>
                        <small>Confian√ßa: ${item.confidence}%</small><br>
                        <small style="opacity: 0.7;">${timeAgo}</small>
                    </div>
                    <div style="color: #22c55e;">${status}</div>
                `;
                
                historyScreen.appendChild(historyDiv);
            });
            
            const economyDiv = document.createElement('div');
            economyDiv.style.marginTop = '30px';
            economyDiv.style.textAlign = 'center';
            economyDiv.style.opacity = '0.7';
            
            const totalSavings = historyData.length * 150;
            economyDiv.innerHTML = `
                <p>Economia total: <strong style="color: #22c55e;">R$ ${totalSavings.toLocaleString()}</strong></p>
                <p>Versus consultoria tradicional</p>
            `;
            historyScreen.appendChild(economyDiv);
        }

        // Calcular tempo decorrido
        function getTimeAgo(date) {
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);
            
            if (diffMins < 60) return `H√° ${diffMins} minutos`;
            if (diffHours < 24) return `H√° ${diffHours} horas`;
            return `H√° ${diffDays} dias`;
        }

        // Fechar modal
        function closeModal() {
            document.querySelectorAll('.modal').forEach(modal => {
                modal.style.display = 'none';
            });
            
            const video = document.getElementById('cameraVideo');
            if (video.srcObject) {
                const stream = video.srcObject;
                stream.getTracks().forEach(track => track.stop());
                video.srcObject = null;
            }
        }

        // Verificar se algum modal est√° aberto
        function isModalOpen() {
            const modals = document.querySelectorAll('.modal');
            return Array.from(modals).some(modal => modal.style.display === 'block');
        }

        // Configurar PWA
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('data:text/javascript;base64,c2VsZi5hZGRFdmVudExpc3RlbmVyKCdpbnN0YWxsJywgZXZlbnQgPT4ge30p')
                .then(() => console.log('PWA instalado com sucesso'))
                .catch(() => console.log('Falha na instala√ß√£o do PWA'));
        }

        // Simular instala√ß√£o PWA
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            
            setTimeout(() => {
                if (deferredPrompt) {
                    const installBtn = document.createElement('button');
                    installBtn.textContent = 'üì± Instalar App';
                    installBtn.className = 'secondary-btn';
                    installBtn.style.position = 'fixed';
                    installBtn.style.top = '20px';
                    installBtn.style.right = '20px';
                    installBtn.style.zIndex = '1000';
                    
                    installBtn.onclick = () => {
                        deferredPrompt.prompt();
                        deferredPrompt.userChoice.then((choiceResult) => {
                            if (choiceResult.outcome === 'accepted') {
                                console.log('App instalado!');
                            }
                            deferredPrompt = null;
                            installBtn.remove();
                        });
                    };
                    
                    document.body.appendChild(installBtn);
                }
            }, 5000);
        });

        // Navega√ß√£o por gestos (swipe)
        let startY = 0;
        let startX = 0;
        let isScrolling = false;

        document.addEventListener('touchstart', (e) => {
            startY = e.touches[0].clientY;
            startX = e.touches[0].clientX;
            isScrolling = false;
        });

        document.addEventListener('touchmove', (e) => {
            const currentY = e.touches[0].clientY;
            const diffY = Math.abs(startY - currentY);
            if (diffY > 20) {
                isScrolling = true;
            }
        });

        document.addEventListener('touchend', (e) => {
            if (isScrolling) return;

            const endY = e.changedTouches[0].clientY;
            const endX = e.changedTouches[0].clientX;
            const diffY = startY - endY;
            const diffX = startX - endX;

            if (diffY > 100 && Math.abs(diffX) < 100 && !isModalOpen()) {
                openCamera();
            }
        });

        // Adicionar efeitos sonoros (simulados)
        function playSound(type) {
            console.log(`üîä Som: ${type}`);
        }

        // Vibra√ß√£o para feedback h√°ptico
        function vibrate(pattern = [100]) {
            if ('vibrate' in navigator) {
                navigator.vibrate(pattern);
            }
        }

        // Configura√ß√µes iniciais
        document.addEventListener('DOMContentLoaded', () => {
            updateOnlineStatus();
            loadHistory();
            
            document.querySelectorAll('button').forEach(btn => {
                btn.addEventListener('click', () => {
                    vibrate([50]);
                    playSound('click');
                });
            });
            
            document.querySelector('.container').classList.add('fade-in');
            
            setTimeout(() => {
                if ('Notification' in window && Notification.permission === 'granted') {
                    new Notification('üö® AgroSOS', {
                        body: 'Alerta: Ferrugem detectada a 2km da sua propriedade',
                        icon: 'üå±'
                    });
                }
            }, 10000);
        });

        // Solicitar permiss√µes
        if ('Notification' in window && Notification.permission === 'default') {
            Notification.requestPermission();
        }

        // Banco de dados de doen√ßas
        const diseaseDatabase = [
            {
                name: 'Ferrugem do Cafeeiro',
                confidence: Math.floor(Math.random() * 10) + 85,
                description: 'Doen√ßa f√∫ngica comum em cafezais. Identificada pelas manchas alaranjadas caracter√≠sticas na parte inferior das folhas.',
                treatments: [
                    { type: 'üè† Receita Caseira', name: 'Calda bordalesa (sulfato de cobre + cal)', cost: 'R$ 8,50' },
                    { type: 'üß™ Tratamento Profissional', name: 'Fungicida √† base de triazol', cost: 'R$ 45,00' }
                ]
            },
            {
                name: 'Cercosporiose',
                confidence: Math.floor(Math.random() * 15) + 80,
                description: 'Doen√ßa f√∫ngica que causa manchas escuras com halos amarelados. Mais comum em per√≠odos √∫midos.',
                treatments: [
                    { type: 'üè† Receita Caseira', name: 'Ch√° de cavalinha + √≥leo de neem', cost: 'R$ 5,20' },
                    { type: 'üß™ Tratamento Profissional', name: 'Fungicida sist√™mico', cost: 'R$ 38,00' }
                ]
            },
            {
                name: 'Broca do Caf√©',
                confidence: Math.floor(Math.random() * 12) + 85,
                description: 'Inseto que perfura os frutos do caf√©. Identificado pelos pequenos furos nos frutos.',
                treatments: [
                    { type: 'üè† Receita Caseira', name: 'Armadilha com √°lcool + detergente', cost: 'R$ 12,00' },
                    { type: 'üß™ Tratamento Profissional', name: 'Inseticida espec√≠fico para broca', cost: 'R$ 55,00' }
                ]
            },
            {
                name: 'Mancha de Phoma',
                confidence: Math.floor(Math.random() * 8) + 87,
                description: 'Doen√ßa f√∫ngica que causa manchas circulares marrons com bordas escuras.',
                treatments: [
                    { type: 'üè† Receita Caseira', name: 'Bicarbonato de s√≥dio + sab√£o neutro', cost: 'R$ 3,80' },
                    { type: 'üß™ Tratamento Profissional', name: 'Fungicida c√∫prico', cost: 'R$ 28,00' }
                ]
            },
            {
                name: 'Planta Saud√°vel',
                confidence: Math.floor(Math.random() * 5) + 95,
                description: 'üéâ Parab√©ns! Sua planta est√° saud√°vel. Continue com os cuidados preventivos para manter a qualidade.',
                treatments: [
                    { type: 'üå± Manuten√ß√£o Preventiva', name: 'Aduba√ß√£o balanceada + irriga√ß√£o adequada', cost: 'R$ 15,00/m√™s' },
                    { type: 'üõ°Ô∏è Preven√ß√£o Avan√ßada', name: 'Programa completo de manejo integrado', cost: 'R$ 85,00/m√™s' }
                ]
            }
        ];

        // Atualiza√ß√£o din√¢mica da comunidade
        function updateCommunityData() {
            const communityItems = document.querySelectorAll('.community-item');
            const diseases = ['Ferrugem severa', 'Cercosporiose', 'Broca ativa', 'Mancha de Phoma'];
            
            setInterval(() => {
                if (Math.random() < 0.1) {
                    const newCase = {
                        name: `Produtor ${Math.floor(Math.random() * 1000)}`,
                        disease: diseases[Math.floor(Math.random() * diseases.length)],
                        distance: (Math.random() * 8 + 0.5).toFixed(1) + 'km'
                    };
                    
                    console.log('üÜï Novo caso na comunidade:', newCase);
                }
            }, 15000);
        }

        // Easter eggs
        let clickCount = 0;
        document.querySelector('.logo').addEventListener('click', () => {
            clickCount++;
            if (clickCount === 5) {
                alert('üéâ Modo desenvolvedor ativado!\n\nüìä Estat√≠sticas:\n‚Ä¢ An√°lises processadas: ' + analysisCount + '\n‚Ä¢ Usu√°rios ativos: ' + userCount + '\n‚Ä¢ Uptime: 99.8%\n‚Ä¢ √öltima atualiza√ß√£o: ' + new Date().toLocaleString());
                clickCount = 0;
            }
        });

        // Simula√ß√£o de notifica√ß√µes push peri√≥dicas
        setInterval(() => {
            if (Math.random() < 0.1 && 'Notification' in window && Notification.permission === 'granted') {
                const alerts = [
                    'Novo surto de ferrugem detectado a 3km',
                    'Condi√ß√µes clim√°ticas favor√°veis para doen√ßas',
                    '5 produtores pr√≥ximos usaram tratamento caseiro com sucesso',
                    'Alerta meteorol√≥gico: chuvas intensas previstas'
                ];
                
                const randomAlert = alerts[Math.floor(Math.random() * alerts.length)];
                
                new Notification('üö® AgroSOS - Alerta Regional', {
                    body: randomAlert,
                    icon: 'üå±',
                    requireInteraction: false
                });
            }
        }, 30000);

        // Funcionalidade de compartilhamento
        function shareResult(result) {
            if (navigator.share) {
                navigator.share({
                    title: 'AgroSOS - Diagn√≥stico',
                    text: `Diagnostiquei ${result.name} com ${result.confidence}% de confian√ßa usando o AgroSOS!`,
                    url: 'https://agrosos.com.br'
                });
            }
        }

        // Modo escuro/claro
        function toggleTheme() {
            document.body.classList.toggle('dark-theme');
        }

        // Salvamento autom√°tico de prefer√™ncias
        function savePreferences() {
            const prefs = {
                notifications: true,
                offlineMode: true,
                language: 'pt-BR',
                theme: 'auto'
            };
            localStorage.setItem('agroSosPrefs', JSON.stringify(prefs));
        }

        // Carregar prefer√™ncias
        function loadPreferences() {
            const prefs = JSON.parse(localStorage.getItem('agroSosPrefs') || '{}');
            return prefs;
        }

        // Inicializar app
        document.addEventListener('DOMContentLoaded', () => {
            loadPreferences();
            savePreferences();
            updateCommunityData();
            
            if (!localStorage.getItem('agroSosFirstVisit')) {
                setTimeout(() => {
                    alert('üëã Bem-vindo ao AgroSOS!\n\nüì∏ Dica: Deslize para cima ou clique em "Analisar Planta" para come√ßar!\n\nüå± Ajudamos voc√™ a identificar doen√ßas em segundos!');
                    localStorage.setItem('agroSosFirstVisit', 'true');
                }, 2000);
            }
        });
    </script>
</body>
</html>