<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.21.0/dist/tf.min.js"></script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AgroSOS - Assistente Agr√≠cola Inteligente</title>
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiQWdyb1NPUyIsInNob3J0X25hbWUiOiJBZ3JvU09TIiwic3RhcnRfdXJsIjoiLyIsImRpc3BsYXkiOiJzdGFuZGFsb25lIiwiYmFja2dyb3VuZF9jb2xvciI6IiMyMjc3M2QiLCJ0aGVtZV9jb2xvciI6IiMyMjc3M2QifQ==">
    <meta name="theme-color" content="#22773d">
    <link rel="stylesheet" href="../styles.css">
 
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="logo">
                <div class="logo-icon">üå±</div>
                <h1>AgroSOS</h1>
            </div>
            <div class="tagline">Seu assistente para cafezais saud√°veis</div>
        </div>

        <!-- Offline Indicator -->
        <div class="offline-indicator" id="offlineIndicator" style="display: none;">
            üì± Modo Offline Ativo - IA funcionando localmente
        </div>

        <!-- Home Screen -->
        <div class="screen active" id="homeScreen">
            <!-- Stats -->
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-number" id="analysisCount">1,247</div>
                    <div class="stat-label">An√°lises hoje</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">96%</div>
                    <div class="stat-label">Precis√£o da IA</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">R$ 150</div>
                    <div class="stat-label">Economia m√©dia</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="userCount">12.5K</div>
                    <div class="stat-label">Produtores ativos</div>
                </div>
            </div>

            <!-- Main Actions -->
            <div class="main-actions">
                <button class="analyze-btn" onclick="openCamera()" aria-label="Iniciar an√°lise de planta">
                    üì∏ Analisar Planta
                </button>
                
                <div class="secondary-actions">
                    <button class="secondary-btn" onclick="showScreen('communityScreen')" aria-label="Ver mapa regional">
                        üó∫Ô∏è Mapa Regional
                    </button>
                    <button class="secondary-btn" onclick="showScreen('historyScreen')" aria-label="Ver hist√≥rico de an√°lises">
                        üìã Hist√≥rico
                    </button>
                </div>
            </div>

            <!-- Recent Alerts -->
            <div style="padding: 0 20px;">
                <h3 style="margin-bottom: 15px;">‚ö†Ô∏è Alertas na Regi√£o</h3>
                <div class="alert-item">
                    <strong>Ferrugem do Cafeeiro</strong><br>
                    <small>3 casos reportados em um raio de 5km</small>
                    <div class="distance">2.3km de dist√¢ncia</div>
                </div>
                <div class="alert-item">
                    <strong>Broca do Caf√©</strong><br>
                    <small>Surto ativo - 8 propriedades afetadas</small>
                    <div class="distance">4.7km de dist√¢ncia</div>
                </div>
            </div>
        </div>

        <!-- Community Screen -->
        <div class="screen" id="communityScreen">
            <h2 style="margin-bottom: 20px;">üåç Comunidade Regional</h2>
            
            <div class="map-container">
                <div class="map-pin" style="top: 20%; left: 30%;"></div>
                <div class="map-pin" style="top: 60%; left: 70%;"></div>
                <div class="map-pin" style="top: 40%; left: 45%;"></div>
                <div class="map-pin" style="top: 80%; left: 20%;"></div>
                <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: rgba(255,255,255,0.7);">
                    Regi√£o de Minas Gerais<br>
                    <small>4 surtos ativos detectados</small>
                </div>
            </div>

            <div class="community-section">
                <h4>Casos Recentes (√∫ltimas 24h)</h4>
                <div class="community-item">
                    <div>üî¥</div>
                    <div>
                        <strong>Jo√£o Silva</strong> - Ferrugem severa<br>
                        <small>Fazenda S√£o Jos√©</small>
                    </div>
                    <div class="distance">1.2km</div>
                </div>
                <div class="community-item">
                    <div>üü°</div>
                    <div>
                        <strong>Maria Santos</strong> - Cercosporiose<br>
                        <small>S√≠tio Boa Vista</small>
                    </div>
                    <div class="distance">3.5km</div>
                </div>
                <div class="community-item">
                    <div>üî¥</div>
                    <div>
                        <strong>Pedro Costa</strong> - Broca ativa<br>
                        <small>Fazenda Esperan√ßa</small>
                    </div>
                    <div class="distance">5.1km</div>
                </div>
            </div>
        </div>

        <!-- History Screen -->
        <div class="screen" id="historyScreen">
            <h2 style="margin-bottom: 20px;">üìã Seu Hist√≥rico</h2>
            
            <div class="history-item">
                <div>
                    <strong>Ferrugem do Cafeeiro</strong><br>
                    <small>Talh√£o 3 - Tratado com sucesso</small><br>
                    <small style="opacity: 0.7;">H√° 3 dias</small>
                </div>
                <div style="color: #22c55e;">‚úÖ</div>
            </div>
            
            <div class="history-item">
                <div>
                    <strong>Planta Saud√°vel</strong><br>
                    <small>Talh√£o 1 - Sem problemas detectados</small><br>
                    <small style="opacity: 0.7;">H√° 1 semana</small>
                </div>
                <div style="color: #22c55e;">‚úÖ</div>
            </div>
            
            <div class="history-item">
                <div>
                    <strong>Cercosporiose</strong><br>
                    <small>Talh√£o 2 - Em tratamento</small><br>
                    <small style="opacity: 0.7;">H√° 2 semanas</small>
                </div>
                <div style="color: #f59e0b;">üîÑ</div>
            </div>

            <div style="margin-top: 30px; text-align: center; opacity: 0.7;">
                <p>Economia total: <strong style="color: #22c55e;">R$ 450,00</strong></p>
                <p>Versus consultoria tradicional</p>
            </div>
        </div>

        <!-- Camera Choice Modal -->
        <div class="modal" id="cameraModal">
            <div class="modal-content">
                <button class="close-btn" onclick="closeModal()" aria-label="Fechar modal">&times;</button>
                <h3>üì∏ Analisar Planta</h3>
                <p>Escolha como fornecer a imagem da planta:</p>
                
                <div style="display: flex; flex-direction: column; gap: 15px; margin: 20px 0;">
                    <button class="capture-btn" onclick="openCameraStream()" style="width: 100%; border-radius: 10px; padding: 15px;" aria-label="Usar c√¢mera para capturar imagem">
                        üì∑ Usar C√¢mera
                    </button>
                    <button class="capture-btn" onclick="triggerFileUpload()" style="width: 100%; border-radius: 10px; padding: 15px;" aria-label="Fazer upload de imagem">
                        üì§ Fazer Upload
                    </button>
                </div>
                
                <!-- Hidden file input for uploads -->
                <input type="file" id="imageUpload" accept="image/*" style="display: none;" onchange="handleFileUpload(event)">
                
                <p style="font-size: 12px; opacity: 0.7; margin-top: 10px;">
                    Dica: Fotografe folhas ou frutos com boa ilumina√ß√£o, fundo limpo e foco n√≠tido.
                </p>
            </div>
        </div>

        <!-- Camera Stream Modal -->
        <div class="modal" id="cameraStreamModal">
            <div class="modal-content">
                <button class="close-btn" onclick="closeModal()" aria-label="Fechar modal">&times;</button>
                <h3>üì∏ Fotografar Planta</h3>
                <p>Centralize a folha ou fruto no quadro verde</p>
                
                <div class="camera-preview">
                    <video id="cameraVideo" autoplay playsinline style="width: 100%; height: 100%; object-fit: cover;"></video>
                    <canvas id="cameraCanvas" style="display: none;"></canvas>
                    <div class="camera-overlay"></div>
                </div>
                
                <button class="capture-btn" onclick="capturePhotoFromCamera()" aria-label="Capturar foto">üì∏</button>
                <p style="font-size: 12px; opacity: 0.7; margin-top: 10px;">
                    Evite sombras, mantenha a c√¢mera est√°vel e use luz natural.
                </p>
            </div>
        </div>

        <!-- Analysis Modal -->
        <div class="modal" id="analysisModal">
            <div class="modal-content">
                <h3>ü§ñ Analisando...</h3>
                <div class="loading"></div>
                <p>Processando imagem com IA avan√ßada</p>
                <p style="font-size: 12px; opacity: 0.7;">Isso leva alguns segundos</p>
            </div>
        </div>

        <!-- Result Modal -->
        <div class="modal result-modal" id="resultModal">
            <div class="modal-content">
                <button class="close-btn" onclick="closeModal()" aria-label="Fechar modal">&times;</button>
                <h3>üéØ Diagn√≥stico Completo</h3>
                <img id="analyzedImage" class="image-preview" style="display: none;" alt="Imagem analisada">
                
                <div class="disease-info">
                    <h4 id="diseaseName"></h4>
                    <div class="confidence" id="confidence"></div>
                    <p style="margin-top: 10px; opacity: 0.9;" id="diseaseDescription"></p>
                    <p class="warning" id="imageQualityWarning" style="display: none;"></p>
                </div>

                <div class="treatment-section">
                    <h4>üíä Tratamentos Recomendados</h4>
                    <div id="treatments"></div>
                </div>

                <div class="prevention-section">
                    <h4>üõ°Ô∏è Preven√ß√£o</h4>
                    <div id="preventions"></div>
                </div>

                <div class="community-section">
                    <h4>üë• Outros Casos na Regi√£o</h4>
                    <div class="community-item">
                        <div>üìç</div>
                        <div id="communityCases"></div>
                    </div>
                    <div class="community-item">
                        <div>‚è∞</div>
                        <div id="communityTime"></div>
                    </div>
                </div>

                <button class="analyze-btn" onclick="closeModal()" style="margin-top: 20px;" aria-label="Fechar resultado">
                    üö™ Fechar
                </button>
                <button class="secondary-btn" onclick="openCamera()" style="margin-top: 10px; display: none;" id="retryButton" aria-label="Tentar novamente">
                    üì∏ Tentar Novamente
                </button>
            </div>
        </div>

        <!-- Navigation -->
        <div class="navigation">
            <div class="nav-item active" onclick="showScreen('homeScreen')" aria-label="Ir para tela inicial">
                <div class="nav-icon">üè†</div>
                <div class="nav-label">In√≠cio</div>
            </div>
            <div class="nav-item" onclick="openCamera()" aria-label="Analisar planta">
                <div class="nav-icon">üì∏</div>
                <div class="nav-label">Analisar</div>
            </div>
            <div class="nav-item" onclick="showScreen('communityScreen')" aria-label="Ver comunidade">
                <div class="nav-icon">üó∫Ô∏è</div>
                <div class="nav-label">Comunidade</div>
            </div>
            <div class="nav-item" onclick="showScreen('historyScreen')" aria-label="Ver hist√≥rico">
                <div class="nav-icon">üìã</div>
                <div class="nav-label">Hist√≥rico</div>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.12.0/dist/tf.min.js"></script>
    <script src="../ai-model/script.js"></script>
    
</body>
</html>