<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AgroSOS - Assistente Agr√≠cola Inteligente</title>
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiQWdyb1NPUyIsInNob3J0X25hbWUiOiJBZ3JvU09TIiwic3RhcnRfdXJsIjoiLyIsImRpc3BsYXkiOiJzdGFuZGFsb25lIiwiYmFja2dyb3VuZF9jb2xvciI6IiMyMjc3M2QiLCJ0aGVtZV9jb2xvciI6IiMyMjc3M2QifQ==">
    <meta name="theme-color" content="#22773d">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 400px;
            margin: 0 auto;
            min-height: 100vh;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-left: 1px solid rgba(255, 255, 255, 0.1);
            border-right: 1px solid rgba(255, 255, 255, 0.1);
        }

        .header {
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .tagline {
            opacity: 0.9;
            font-size: 14px;
        }

        .stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            padding: 20px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 15px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(5px);
        }

        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #22c55e;
        }

        .stat-label {
            font-size: 12px;
            opacity: 0.8;
            margin-top: 5px;
        }

        .main-actions {
            padding: 20px;
        }

        .analyze-btn {
            width: 100%;
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
            border: none;
            border-radius: 15px;
            padding: 20px;
            color: white;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(34, 197, 94, 0.3);
            margin-bottom: 15px;
        }

        .analyze-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 35px rgba(34, 197, 94, 0.4);
        }

        .secondary-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .secondary-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            padding: 15px 10px;
            color: white;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .secondary-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-1px);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            border-radius: 20px;
            padding: 20px;
            width: 90%;
            max-width: 380px;
            max-height: 90vh;
            overflow-y: auto;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.3);
        }

        .camera-preview {
            width: 100%;
            height: 200px;
            background: #000;
            border-radius: 15px;
            margin: 20px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            position: relative;
            overflow: hidden;
        }

        .camera-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 150px;
            height: 150px;
            border: 3px solid #22c55e;
            border-radius: 15px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
            50% { opacity: 0.6; transform: translate(-50%, -50%) scale(1.05); }
            100% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .capture-btn {
            background: #22c55e;
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            color: white;
            font-size: 24px;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s ease;
        }

        .capture-btn:hover {
            transform: scale(1.1);
            background: #16a34a;
        }

        .close-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(255, 255, 255, 0.3);
            border: none;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            color: white;
            cursor: pointer;
            font-size: 20px;
            line-height: 32px;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            background: rgba(239, 68, 68, 0.5);
        }

        .result-modal .modal-content {
            text-align: left;
        }

        .disease-info {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 15px;
            margin: 15px 0;
        }

        .confidence {
            display: inline-block;
            background: #22c55e;
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            margin-top: 10px;
        }

        .treatment-section, .prevention-section {
            margin-top: 20px;
        }

        .treatment-option, .prevention-option {
            background: rgba(34, 197, 94, 0.2);
            border: 1px solid rgba(34, 197, 94, 0.4);
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
        }

        .price {
            color: #22c55e;
            font-weight: bold;
            font-size: 16px;
        }

        .community-section {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 15px;
            margin: 15px 0;
        }

        .community-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .community-item:last-child {
            border-bottom: none;
        }

        .distance {
            background: rgba(34, 197, 94, 0.3);
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 11px;
        }

        .loading {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #22c55e;
            animation: spin 1s ease-in-out infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .offline-indicator {
            background: #f59e0b;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 12px;
            margin: 10px 20px;
            text-align: center;
        }

        .map-container {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            height: 150px;
            margin: 15px 0;
            position: relative;
            overflow: hidden;
        }

        .map-pin {
            position: absolute;
            width: 12px;
            height: 12px;
            background: #ef4444;
            border-radius: 50%;
            animation: ping 2s infinite;
        }

        @keyframes ping {
            0% { transform: scale(1); opacity: 1; }
            75%, 100% { transform: scale(2); opacity: 0; }
        }

        .navigation {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 400px;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            display: flex;
            justify-content: space-around;
            padding: 15px 0;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            cursor: pointer;
            padding: 5px 15px;
            border-radius: 10px;
            transition: all 0.3s ease;
        }

        .nav-item:hover, .nav-item.active {
            background: rgba(34, 197, 94, 0.3);
        }

        .nav-icon {
            font-size: 20px;
        }

        .nav-label {
            font-size: 10px;
            opacity: 0.8;
        }

        .screen {
            display: none;
            padding: 20px;
            padding-bottom: 100px;
        }

        .screen.active {
            display: block;
        }

        .alert-item {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid rgba(239, 68, 68, 0.4);
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
        }

        .history-item {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .fade-in {
            animation: fadeIn 0.5s ease;
        }

        .bounce-in {
            animation: bounceIn 0.6s ease;
        }

        @keyframes bounceIn {
            0% { transform: scale(0.3); opacity: 0; }
            50% { transform: scale(1.05); }
            70% { transform: scale(0.9); }
            100% { transform: scale(1); opacity: 1; }
        }

        .image-preview {
            max-width: 100%;
            width: auto;
            height: auto;
            max-height: 200px;
            border-radius: 10px;
            margin: 10px 0;
            object-fit: contain;
        }

        .warning {
            color: #f59e0b;
            font-size: 12px;
            margin-top: 10px;
        }

        /* Media Queries para Responsividade */
        @media (max-width: 400px) {
            .container {
                max-width: 100%;
            }

            .modal-content {
                width: 95%;
                padding: 15px;
                font-size: 14px;
            }

            .analyze-btn, .secondary-btn {
                font-size: 16px;
                padding: 15px;
            }

            .disease-info, .treatment-section, .prevention-section, .community-section {
                padding: 10px;
            }

            .disease-info h4 {
                font-size: 18px;
            }

            .confidence {
                font-size: 11px;
                padding: 4px 8px;
            }

            .close-btn {
                width: 28px;
                height: 28px;
                font-size: 18px;
                line-height: 28px;
            }

            .camera-preview {
                height: 180px;
            }

            .camera-overlay {
                width: 120px;
                height: 120px;
            }
        }

        @media (max-height: 600px) {
            .modal-content {
                max-height: 85vh;
                padding: 10px;
            }

            .image-preview {
                max-height: 150px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="logo">
                <div class="logo-icon">üå±</div>
                <h1>AgroSOS</h1>
            </div>
            <div class="tagline">Seu assistente para cafezais saud√°veis</div>
        </div>

        <!-- Offline Indicator -->
        <div class="offline-indicator" id="offlineIndicator" style="display: none;">
            üì± Modo Offline Ativo - IA funcionando localmente
        </div>

        <!-- Home Screen -->
        <div class="screen active" id="homeScreen">
            <!-- Stats -->
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-number" id="analysisCount">1,247</div>
                    <div class="stat-label">An√°lises hoje</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">96%</div>
                    <div class="stat-label">Precis√£o da IA</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">R$ 150</div>
                    <div class="stat-label">Economia m√©dia</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="userCount">12.5K</div>
                    <div class="stat-label">Produtores ativos</div>
                </div>
            </div>

            <!-- Main Actions -->
            <div class="main-actions">
                <button class="analyze-btn" onclick="openCamera()" aria-label="Iniciar an√°lise de planta">
                    üì∏ Analisar Planta
                </button>
                
                <div class="secondary-actions">
                    <button class="secondary-btn" onclick="showScreen('communityScreen')" aria-label="Ver mapa regional">
                        üó∫Ô∏è Mapa Regional
                    </button>
                    <button class="secondary-btn" onclick="showScreen('historyScreen')" aria-label="Ver hist√≥rico de an√°lises">
                        üìã Hist√≥rico
                    </button>
                </div>
            </div>

            <!-- Recent Alerts -->
            <div style="padding: 0 20px;">
                <h3 style="margin-bottom: 15px;">‚ö†Ô∏è Alertas na Regi√£o</h3>
                <div class="alert-item">
                    <strong>Ferrugem do Cafeeiro</strong><br>
                    <small>3 casos reportados em um raio de 5km</small>
                    <div class="distance">2.3km de dist√¢ncia</div>
                </div>
                <div class="alert-item">
                    <strong>Broca do Caf√©</strong><br>
                    <small>Surto ativo - 8 propriedades afetadas</small>
                    <div class="distance">4.7km de dist√¢ncia</div>
                </div>
            </div>
        </div>

        <!-- Community Screen -->
        <div class="screen" id="communityScreen">
            <h2 style="margin-bottom: 20px;">üåç Comunidade Regional</h2>
            
            <div class="map-container">
                <div class="map-pin" style="top: 20%; left: 30%;"></div>
                <div class="map-pin" style="top: 60%; left: 70%;"></div>
                <div class="map-pin" style="top: 40%; left: 45%;"></div>
                <div class="map-pin" style="top: 80%; left: 20%;"></div>
                <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: rgba(255,255,255,0.7);">
                    Regi√£o de Minas Gerais<br>
                    <small>4 surtos ativos detectados</small>
                </div>
            </div>

            <div class="community-section">
                <h4>Casos Recentes (√∫ltimas 24h)</h4>
                <div class="community-item">
                    <div>üî¥</div>
                    <div>
                        <strong>Jo√£o Silva</strong> - Ferrugem severa<br>
                        <small>Fazenda S√£o Jos√©</small>
                    </div>
                    <div class="distance">1.2km</div>
                </div>
                <div class="community-item">
                    <div>üü°</div>
                    <div>
                        <strong>Maria Santos</strong> - Cercosporiose<br>
                        <small>S√≠tio Boa Vista</small>
                    </div>
                    <div class="distance">3.5km</div>
                </div>
                <div class="community-item">
                    <div>üî¥</div>
                    <div>
                        <strong>Pedro Costa</strong> - Broca ativa<br>
                        <small>Fazenda Esperan√ßa</small>
                    </div>
                    <div class="distance">5.1km</div>
                </div>
            </div>
        </div>

        <!-- History Screen -->
        <div class="screen" id="historyScreen">
            <h2 style="margin-bottom: 20px;">üìã Seu Hist√≥rico</h2>
            
            <div class="history-item">
                <div>
                    <strong>Ferrugem do Cafeeiro</strong><br>
                    <small>Talh√£o 3 - Tratado com sucesso</small><br>
                    <small style="opacity: 0.7;">H√° 3 dias</small>
                </div>
                <div style="color: #22c55e;">‚úÖ</div>
            </div>
            
            <div class="history-item">
                <div>
                    <strong>Planta Saud√°vel</strong><br>
                    <small>Talh√£o 1 - Sem problemas detectados</small><br>
                    <small style="opacity: 0.7;">H√° 1 semana</small>
                </div>
                <div style="color: #22c55e;">‚úÖ</div>
            </div>
            
            <div class="history-item">
                <div>
                    <strong>Cercosporiose</strong><br>
                    <small>Talh√£o 2 - Em tratamento</small><br>
                    <small style="opacity: 0.7;">H√° 2 semanas</small>
                </div>
                <div style="color: #f59e0b;">üîÑ</div>
            </div>

            <div style="margin-top: 30px; text-align: center; opacity: 0.7;">
                <p>Economia total: <strong style="color: #22c55e;">R$ 450,00</strong></p>
                <p>Versus consultoria tradicional</p>
            </div>
        </div>

        <!-- Camera Choice Modal -->
        <div class="modal" id="cameraModal">
            <div class="modal-content">
                <button class="close-btn" onclick="closeModal()" aria-label="Fechar modal">&times;</button>
                <h3>üì∏ Analisar Planta</h3>
                <p>Escolha como fornecer a imagem da planta:</p>
                
                <div style="display: flex; flex-direction: column; gap: 15px; margin: 20px 0;">
                    <button class="capture-btn" onclick="openCameraStream()" style="width: 100%; border-radius: 10px; padding: 15px;" aria-label="Usar c√¢mera para capturar imagem">
                        üì∑ Usar C√¢mera
                    </button>
                    <button class="capture-btn" onclick="triggerFileUpload()" style="width: 100%; border-radius: 10px; padding: 15px;" aria-label="Fazer upload de imagem">
                        üì§ Fazer Upload
                    </button>
                </div>
                
                <!-- Hidden file input for uploads -->
                <input type="file" id="imageUpload" accept="image/*" style="display: none;" onchange="handleFileUpload(event)">
                
                <p style="font-size: 12px; opacity: 0.7; margin-top: 10px;">
                    Dica: Fotografe folhas ou frutos com boa ilumina√ß√£o, fundo limpo e foco n√≠tido.
                </p>
            </div>
        </div>

        <!-- Camera Stream Modal -->
        <div class="modal" id="cameraStreamModal">
            <div class="modal-content">
                <button class="close-btn" onclick="closeModal()" aria-label="Fechar modal">&times;</button>
                <h3>üì∏ Fotografar Planta</h3>
                <p>Centralize a folha ou fruto no quadro verde</p>
                
                <div class="camera-preview">
                    <video id="cameraVideo" autoplay playsinline style="width: 100%; height: 100%; object-fit: cover;"></video>
                    <canvas id="cameraCanvas" style="display: none;"></canvas>
                    <div class="camera-overlay"></div>
                </div>
                
                <button class="capture-btn" onclick="capturePhotoFromCamera()" aria-label="Capturar foto">üì∏</button>
                <p style="font-size: 12px; opacity: 0.7; margin-top: 10px;">
                    Evite sombras, mantenha a c√¢mera est√°vel e use luz natural.
                </p>
            </div>
        </div>

        <!-- Analysis Modal -->
        <div class="modal" id="analysisModal">
            <div class="modal-content">
                <h3>ü§ñ Analisando...</h3>
                <div class="loading"></div>
                <p>Processando imagem com IA avan√ßada</p>
                <p style="font-size: 12px; opacity: 0.7;">Isso leva alguns segundos</p>
            </div>
        </div>

        <!-- Result Modal -->
        <div class="modal result-modal" id="resultModal">
            <div class="modal-content">
                <button class="close-btn" onclick="closeModal()" aria-label="Fechar modal">&times;</button>
                <h3>üéØ Diagn√≥stico Completo</h3>
                <img id="analyzedImage" class="image-preview" style="display: none;" alt="Imagem analisada">
                
                <div class="disease-info">
                    <h4 id="diseaseName"></h4>
                    <div class="confidence" id="confidence"></div>
                    <p style="margin-top: 10px; opacity: 0.9;" id="diseaseDescription"></p>
                    <p class="warning" id="imageQualityWarning" style="display: none;"></p>
                </div>

                <div class="treatment-section">
                    <h4>üíä Tratamentos Recomendados</h4>
                    <div id="treatments"></div>
                </div>

                <div class="prevention-section">
                    <h4>üõ°Ô∏è Preven√ß√£o</h4>
                    <div id="preventions"></div>
                </div>

                <div class="community-section">
                    <h4>üë• Outros Casos na Regi√£o</h4>
                    <div class="community-item">
                        <div>üìç</div>
                        <div id="communityCases"></div>
                    </div>
                    <div class="community-item">
                        <div>‚è∞</div>
                        <div id="communityTime"></div>
                    </div>
                </div>

                <button class="analyze-btn" onclick="closeModal()" style="margin-top: 20px;" aria-label="Fechar resultado">
                    üö™ Fechar
                </button>
                <button class="secondary-btn" onclick="openCamera()" style="margin-top: 10px; display: none;" id="retryButton" aria-label="Tentar novamente">
                    üì∏ Tentar Novamente
                </button>
            </div>
        </div>

        <!-- Navigation -->
        <div class="navigation">
            <div class="nav-item active" onclick="showScreen('homeScreen')" aria-label="Ir para tela inicial">
                <div class="nav-icon">üè†</div>
                <div class="nav-label">In√≠cio</div>
            </div>
            <div class="nav-item" onclick="openCamera()" aria-label="Analisar planta">
                <div class="nav-icon">üì∏</div>
                <div class="nav-label">Analisar</div>
            </div>
            <div class="nav-item" onclick="showScreen('communityScreen')" aria-label="Ver comunidade">
                <div class="nav-icon">üó∫Ô∏è</div>
                <div class="nav-label">Comunidade</div>
            </div>
            <div class="nav-item" onclick="showScreen('historyScreen')" aria-label="Ver hist√≥rico">
                <div class="nav-icon">üìã</div>
                <div class="nav-label">Hist√≥rico</div>
            </div>
        </div>
    </div>

    <script>
        // Simular dados din√¢micos
        let analysisCount = 1247;
        let userCount = 12500;

        // Atualizar contadores em tempo real
        setInterval(() => {
            analysisCount += Math.floor(Math.random() * 3);
            userCount += Math.floor(Math.random() * 2);
            
            document.getElementById('analysisCount').textContent = analysisCount.toLocaleString();
            document.getElementById('userCount').textContent = (userCount / 1000).toFixed(1) + 'K';
        }, 3000);

        // Detectar se est√° offline
        function updateOnlineStatus() {
            const indicator = document.getElementById('offlineIndicator');
            if (!navigator.onLine) {
                indicator.style.display = 'block';
            } else {
                indicator.style.display = 'none';
            }
        }

        window.addEventListener('online', updateOnlineStatus);
        window.addEventListener('offline', updateOnlineStatus);

        // Navega√ß√£o entre telas
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            
            document.getElementById(screenId).classList.add('active');
            
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            if (screenId === 'homeScreen') {
                document.querySelector('.nav-item').classList.add('active');
            } else {
                document.querySelector(`.nav-item[onclick="showScreen('${screenId}')"]`).classList.add('active');
            }
        }

        // Abrir modal de escolha (c√¢mera ou upload)
        function openCamera() {
            document.getElementById('cameraModal').style.display = 'block';
            document.querySelector('#cameraModal .modal-content').classList.add('bounce-in');
        }

        // Abrir stream da c√¢mera
        async function openCameraStream() {
            closeModal();
            const video = document.getElementById('cameraVideo');
            
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { facingMode: 'environment', width: { ideal: 1280 }, height: { ideal: 720 } }
                });
                video.srcObject = stream;
                document.getElementById('cameraStreamModal').style.display = 'block';
                document.querySelector('#cameraStreamModal .modal-content').classList.add('bounce-in');
            } catch (error) {
                console.error('Erro ao acessar a c√¢mera:', error);
                alert('N√£o foi poss√≠vel acessar a c√¢mera. Tente fazer upload de uma imagem.');
                closeModal();
                openCamera();
            }
        }

        // Acionar input de upload
        function triggerFileUpload() {
            document.getElementById('imageUpload').click();
        }

        // Lidar com upload de arquivo
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (file) {
                closeModal();
                preprocessImage(file, processImage);
            }
        }

        // Capturar foto da c√¢mera
        function capturePhotoFromCamera() {
            const video = document.getElementById('cameraVideo');
            const canvas = document.getElementById('cameraCanvas');
            const context = canvas.getContext('2d');
            
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            
            context.drawImage(video, 0, 0, canvas.width, canvas.height);
            
            canvas.toBlob(blob => {
                const stream = video.srcObject;
                stream.getTracks().forEach(track => track.stop());
                
                closeModal();
                preprocessImage(blob, processImage);
            }, 'image/jpeg', 0.95);
        }

        // Pr√©-processar imagem
        function preprocessImage(imageBlob, callback) {
            const img = new Image();
            img.onload = () => {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                
                // Redimensionar para 224x224 (tamanho padr√£o para modelos de IA)
                canvas.width = 224;
                canvas.height = 224;
                
                // Normalizar e centralizar
                const scale = Math.min(img.width / 224, img.height / 224);
                const x = (canvas.width - img.width / scale) / 2;
                const y = (canvas.height - img.height / scale) / 2;
                
                ctx.drawImage(img, 0, 0, img.width, img.height, x, y, img.width / scale, img.height / scale);
                
                // Verificar qualidade da imagem
                const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                const quality = checkImageQuality(imageData);
                
                canvas.toBlob(processedBlob => {
                    callback(processedBlob, quality, URL.createObjectURL(imageBlob));
                }, 'image/jpeg', 0.95);
            };
            img.src = URL.createObjectURL(imageBlob);
        }

        // Verificar qualidade da imagem
        function checkImageQuality(imageData) {
            const pixels = imageData.data;
            let brightnessSum = 0;
            let varianceSum = 0;
            let greenPixels = 0;
            
            // Calcular brilho m√©dio e vari√¢ncia
            for (let i = 0; i < pixels.length; i += 4) {
                const r = pixels[i];
                const g = pixels[i + 1];
                const b = pixels[i + 2];
                const brightness = (r + g + b) / 3;
                brightnessSum += brightness;
                
                // Detectar presen√ßa de verde (folhas)
                if (g > r * 1.2 && g > b * 1.2) {
                    greenPixels++;
                }
            }
            
            const meanBrightness = brightnessSum / (pixels.length / 4);
            for (let i = 0; i < pixels.length; i += 4) {
                const brightness = (pixels[i] + pixels[i + 1] + pixels[i + 2]) / 3;
                varianceSum += Math.pow(brightness - meanBrightness, 2);
            }
            
            const variance = varianceSum / (pixels.length / 4);
            const greenRatio = greenPixels / (pixels.length / 4);
            
            // Crit√©rios de qualidade
            const isBlurry = variance < 1000;
            const isPoorlyLit = meanBrightness < 50 || meanBrightness > 200;
            const isLeafPresent = greenRatio > 0.1;
            
            return {
                isAcceptable: !isBlurry && !isPoorlyLit && isLeafPresent,
                warnings: [
                    isBlurry ? 'Imagem parece estar desfocada.' : '',
                    isPoorlyLit ? 'Ilumina√ß√£o inadequada (muito escura ou clara).' : '',
                    !isLeafPresent ? 'Folha ou fruto n√£o detectado claramente.' : ''
                ].filter(w => w)
            };
        }

        // Processar imagem com IA simulada
        function processImage(imageBlob, quality, imageUrl) {
            document.getElementById('analysisModal').style.display = 'block';
            
            const processingTime = quality.isAcceptable ? 3000 : 2000;
            
            setTimeout(() => {
                document.getElementById('analysisModal').style.display = 'none';
                
                if (!quality.isAcceptable) {
                    document.getElementById('diseaseName').textContent = 'Imagem de Baixa Qualidade';
                    document.getElementById('confidence').textContent = '0% de confian√ßa';
                    document.getElementById('diseaseDescription').textContent = 'N√£o foi poss√≠vel identificar a doen√ßa devido a problemas com a imagem. Tente novamente com uma foto mais clara.';
                    document.getElementById('imageQualityWarning').textContent = quality.warnings.join(' ');
                    document.getElementById('imageQualityWarning').style.display = 'block';
                    document.getElementById('treatments').innerHTML = '';
                    document.getElementById('preventions').innerHTML = '';
                    document.getElementById('communityCases').textContent = 'Nenhum dado dispon√≠vel';
                    document.getElementById('communityTime').textContent = 'Tire uma nova foto com boa ilumina√ß√£o';
                    document.getElementById('analyzedImage').src = imageUrl;
                    document.getElementById('analyzedImage').style.display = 'block';
                    document.getElementById('retryButton').style.display = 'block';
                    document.getElementById('resultModal').style.display = 'block';
                    document.querySelector('#resultModal .modal-content').classList.add('bounce-in');
                    vibrate([200, 100, 200]);
                    return;
                }
                
                const predictions = simulateModelPrediction(imageBlob, quality);
                const topPrediction = predictions.reduce((a, b) => a.confidence > b.confidence ? a : b);
                
                if (topPrediction.confidence < 0.5) {
                    document.getElementById('diseaseName').textContent = 'Diagn√≥stico Incerto';
                    document.getElementById('confidence').textContent = `${Math.round(topPrediction.confidence * 100)}% de confian√ßa`;
                    document.getElementById('diseaseDescription').textContent = 'N√£o foi poss√≠vel identificar a doen√ßa com confian√ßa. Tente capturar uma imagem mais clara, focando nas folhas ou frutos.';
                    document.getElementById('imageQualityWarning').textContent = 'Confian√ßa baixa. Certifique-se de que a ilumina√ß√£o √© adequada e a imagem est√° n√≠tida.';
                    document.getElementById('imageQualityWarning').style.display = 'block';
                    document.getElementById('treatments').innerHTML = '';
                    document.getElementById('preventions').innerHTML = '';
                    document.getElementById('communityCases').textContent = 'Nenhum dado dispon√≠vel';
                    document.getElementById('communityTime').textContent = 'Tire uma nova foto para melhor an√°lise';
                    document.getElementById('analyzedImage').src = imageUrl;
                    document.getElementById('analyzedImage').style.display = 'block';
                    document.getElementById('retryButton').style.display = 'block';
                    document.getElementById('resultModal').style.display = 'block';
                    document.querySelector('#resultModal .modal-content').classList.add('bounce-in');
                    vibrate([200, 100, 200]);
                    return;
                }
                
                const result = {
                    ...diseaseDatabase.find(d => d.name === topPrediction.name),
                    confidence: Math.round(topPrediction.confidence * 100),
                    imageUrl
                };
                
                showResult(result);
            }, processingTime);
        }

        // Simular predi√ß√£o de modelo de IA
        function simulateModelPrediction(imageBlob, quality) {
            // Simular caracter√≠sticas extra√≠das da imagem
            const features = {
                leafColor: Math.random(), // 0 (escuro) a 1 (claro)
                spotPresence: Math.random(), // 0 (nenhum) a 1 (muitos)
                holePresence: Math.random(), // 0 (nenhum) a 1 (muitos)
                yellowing: Math.random(), // 0 (sem amarelecimento) a 1 (muito)
                wilting: Math.random(), // 0 (sem murchamento) a 1 (muito)
                humidity: Math.random() * 0.8 + 0.2, // 20-100%
                temperature: Math.random() * 15 + 15, // 15-30¬∞C
                leafDeformation: Math.random() // 0 (sem deforma√ß√£o) a 1 (muita)
            };
            
            // Ajustar caracter√≠sticas com base na qualidade da imagem
            if (!quality.isAcceptable) {
                features.leafColor *= 0.7;
                features.spotPresence *= 0.7;
                features.holePresence *= 0.7;
                features.yellowing *= 0.7;
                features.wilting *= 0.7;
                features.leafDeformation *= 0.7;
            }
            
            const predictions = diseaseDatabase.map(disease => {
                let confidence = 0.05; // Confian√ßa base baixa
                
                switch (disease.name) {
                    case 'Ferrugem do Cafeeiro':
                        confidence = (features.spotPresence > 0.55 && features.leafColor > 0.5 && features.humidity > 0.7) ? 0.95 : 0.1;
                        break;
                    case 'Cercosporiose':
                        confidence = (features.spotPresence > 0.5 && features.leafColor < 0.5 && features.humidity > 0.65) ? 0.92 : 0.08;
                        break;
                    case 'Broca do Caf√©':
                        confidence = (features.holePresence > 0.6 && features.temperature > 20) ? 0.93 : 0.07;
                        break;
                    case 'Mancha de Phoma':
                        confidence = (features.spotPresence > 0.5 && features.leafColor < 0.45 && features.humidity > 0.75) ? 0.90 : 0.06;
                        break;
                    case 'Antracnose':
                        confidence = (features.spotPresence > 0.6 && features.humidity > 0.85 && features.temperature < 25) ? 0.91 : 0.05;
                        break;
                    case 'Bicho-Mineiro':
                        confidence = (features.holePresence > 0.5 && features.leafDeformation > 0.6) ? 0.94 : 0.06;
                        break;
                    case 'Mancha Aureolada':
                        confidence = (features.spotPresence > 0.45 && features.yellowing > 0.5 && features.humidity > 0.6) ? 0.90 : 0.05;
                        break;
                    case 'Ascochyta':
                        confidence = (features.spotPresence > 0.5 && features.wilting > 0.5 && features.humidity > 0.7) ? 0.89 : 0.04;
                        break;
                    case 'Defici√™ncia de Nitrog√™nio':
                        confidence = (features.yellowing > 0.7 && features.leafColor < 0.4 && features.wilting < 0.3) ? 0.92 : 0.03;
                        break;
                    case 'Defici√™ncia de Pot√°ssio':
                        confidence = (features.yellowing > 0.6 && features.leafDeformation > 0.5 && features.wilting < 0.4) ? 0.91 : 0.03;
                        break;
                    case 'Defici√™ncia de F√≥sforo':
                        confidence = (features.leafColor < 0.3 && features.wilting > 0.6 && features.yellowing < 0.4) ? 0.90 : 0.03;
                        break;
                    case 'Estresse H√≠drico':
                        confidence = (features.wilting > 0.7 && features.humidity < 0.4 && features.yellowing > 0.5) ? 0.93 : 0.02;
                        break;
                    case 'Planta Saud√°vel':
                        confidence = (features.leafColor > 0.7 && features.spotPresence < 0.3 && features.holePresence < 0.3 && features.yellowing < 0.3 && features.wilting < 0.3) ? 0.98 : 0.02;
                        break;
                }
                
                confidence *= quality.isAcceptable ? 1 : 0.6;
                return { name: disease.name, confidence };
            });
            
            // Ajustar normaliza√ß√£o para preservar confid√™ncias altas
            const maxConfidence = Math.max(...predictions.map(p => p.confidence));
            if (maxConfidence > 0.9) {
                predictions.forEach(p => {
                    if (p.confidence < maxConfidence) {
                        p.confidence *= 0.3; // Reduzir confid√™ncias menores
                    }
                });
            }
            
            const total = predictions.reduce((sum, p) => sum + p.confidence, 0);
            predictions.forEach(p => p.confidence /= total);
            
            return predictions;
        }

        // Mostrar resultado
        function showResult(result) {
            document.getElementById('diseaseName').textContent = result.name;
            document.getElementById('confidence').textContent = `${result.confidence}% de confian√ßa`;
            document.getElementById('diseaseDescription').textContent = result.description;
            document.getElementById('imageQualityWarning').style.display = 'none';
            
            const treatmentSection = document.getElementById('treatments');
            treatmentSection.innerHTML = '';
            result.treatments.forEach(treatment => {
                const div = document.createElement('div');
                div.className = 'treatment-option';
                div.innerHTML = `
                    <strong>${treatment.type}</strong>
                    <p>${treatment.name}</p>
                    <p class="price">Custo: ${treatment.cost}</p>
                `;
                treatmentSection.appendChild(div);
            });
            
            const preventionSection = document.getElementById('preventions');
            preventionSection.innerHTML = '';
            result.preventions.forEach(prevention => {
                const div = document.createElement('div');
                div.className = 'prevention-option';
                div.innerHTML = `
                    <strong>${prevention.type}</strong>
                    <p>${prevention.name}</p>
                `;
                preventionSection.appendChild(div);
            });
            
            document.getElementById('communityCases').textContent = result.communityCases;
            document.getElementById('communityTime').textContent = result.communityTime;
            
            document.getElementById('analyzedImage').src = result.imageUrl;
            document.getElementById('analyzedImage').style.display = 'block';
            
            document.getElementById('retryButton').style.display = result.confidence < 90 ? 'block' : 'none';
            
            document.getElementById('resultModal').style.display = 'block';
            document.querySelector('#resultModal .modal-content').classList.add('bounce-in');
            
            addToHistory(result);
            
            analysisCount++;
            document.getElementById('analysisCount').textContent = analysisCount.toLocaleString();
            
            vibrate([100, 50, 100]);
            playSound('success');
        }

        // Adicionar ao hist√≥rico
        function addToHistory(result) {
            const historyData = JSON.parse(localStorage.getItem('agroSosHistory') || '[]');
            historyData.unshift({
                ...result,
                date: new Date().toISOString(),
                id: Date.now()
            });
            
            if (historyData.length > 10) {
                historyData.splice(10);
            }
            
            localStorage.setItem('agroSosHistory', JSON.stringify(historyData));
            loadHistory();
        }

        // Carregar hist√≥rico
        function loadHistory() {
            const historyData = JSON.parse(localStorage.getItem('agroSosHistory') || '[]');
            const historyScreen = document.getElementById('historyScreen');
            
            const oldItems = historyScreen.querySelectorAll('.history-item');
            oldItems.forEach(item => item.remove());
            
            const title = document.createElement('h2');
            title.textContent = 'üìã Seu Hist√≥rico';
            title.style.marginBottom = '20px';
            historyScreen.insertBefore(title, historyScreen.firstChild);
            
            if (historyData.length === 0) {
                const emptyDiv = document.createElement('div');
                emptyDiv.style.textAlign = 'center';
                emptyDiv.style.opacity = '0.7';
                emptyDiv.style.marginTop = '50px';
                emptyDiv.innerHTML = `
                    <p>üì± Nenhuma an√°lise ainda</p>
                    <p style="font-size: 14px; margin-top: 10px;">Comece fotografando uma planta!</p>
                `;
                historyScreen.appendChild(emptyDiv);
                return;
            }
            
            historyData.forEach(item => {
                const historyDiv = document.createElement('div');
                historyDiv.className = 'history-item';
                
                const date = new Date(item.date);
                const timeAgo = getTimeAgo(date);
                
                const status = item.name === 'Planta Saud√°vel' ? '‚úÖ' : 
                              item.confidence > 90 ? '‚úÖ' : 'üîÑ';
                
                historyDiv.innerHTML = `
                    <div>
                        <strong>${item.name}</strong><br>
                        <small>Confian√ßa: ${item.confidence}%</small><br>
                        <small style="opacity: 0.7;">${timeAgo}</small>
                    </div>
                    <div style="color: #22c55e;">${status}</div>
                `;
                
                historyScreen.appendChild(historyDiv);
            });
            
            const economyDiv = document.createElement('div');
            economyDiv.style.marginTop = '30px';
            economyDiv.style.textAlign = 'center';
            economyDiv.style.opacity = '0.7';
            
            const totalSavings = historyData.length * 150;
            economyDiv.innerHTML = `
                <p>Economia total: <strong style="color: #22c55e;">R$ ${totalSavings.toLocaleString()}</strong></p>
                <p>Versus consultoria tradicional</p>
            `;
            historyScreen.appendChild(economyDiv);
        }

        // Calcular tempo decorrido
        function getTimeAgo(date) {
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);
            
            if (diffMins < 60) return `H√° ${diffMins} minutos`;
            if (diffHours < 24) return `H√° ${diffHours} horas`;
            return `H√° ${diffDays} dias`;
        }

        // Fechar modal
        function closeModal() {
            document.querySelectorAll('.modal').forEach(modal => {
                modal.style.display = 'none';
            });
            
            const video = document.getElementById('cameraVideo');
            if (video.srcObject) {
                const stream = video.srcObject;
                stream.getTracks().forEach(track => track.stop());
                video.srcObject = null;
            }
        }

        // Fechar modal ao clicar fora
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    closeModal();
                }
            });
        });

        // Verificar se algum modal est√° aberto
        function isModalOpen() {
            const modals = document.querySelectorAll('.modal');
            return Array.from(modals).some(modal => modal.style.display === 'block');
        }

        // Configurar PWA
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('data:text/javascript;base64,c2VsZi5hZGRFdmVudExpc3RlbmVyKCdpbnN0YWxsJywgZXZlbnQgPT4ge30p')
                .then(() => console.log('PWA instalado com sucesso'))
                .catch(() => console.log('Falha na instala√ß√£o do PWA'));
        }

        // Simular instala√ß√£o PWA
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            
            setTimeout(() => {
                if (deferredPrompt) {
                    const installBtn = document.createElement('button');
                    installBtn.textContent = 'üì± Instalar App';
                    installBtn.className = 'secondary-btn';
                    installBtn.style.position = 'fixed';
                    installBtn.style.top = '20px';
                    installBtn.style.right = '20px';
                    installBtn.style.zIndex = '1000';
                    
                    installBtn.onclick = () => {
                        deferredPrompt.prompt();
                        deferredPrompt.userChoice.then((choiceResult) => {
                            if (choiceResult.outcome === 'accepted') {
                                console.log('App instalado!');
                            }
                            deferredPrompt = null;
                            installBtn.remove();
                        });
                    };
                    
                    document.body.appendChild(installBtn);
                }
            }, 5000);
        });

        // Navega√ß√£o por gestos (swipe)
        let startY = 0;
        let startX = 0;
        let isScrolling = false;

        document.addEventListener('touchstart', (e) => {
            startY = e.touches[0].clientY;
            startX = e.touches[0].clientX;
            isScrolling = false;
        });

        document.addEventListener('touchmove', (e) => {
            const currentY = e.touches[0].clientY;
            const diffY = Math.abs(startY - currentY);
            if (diffY > 20) {
                isScrolling = true;
            }
        });

        document.addEventListener('touchend', (e) => {
            if (isScrolling) return;

            const endY = e.changedTouches[0].clientY;
            const diffY = startY - endY;

            if (diffY > 100 && !isModalOpen()) {
                openCamera();
            }
        });

        // Adicionar efeitos sonoros (simulados)
        function playSound(type) {
            console.log(`üîä Som: ${type}`);
        }

        // Vibra√ß√£o para feedback h√°ptico
        function vibrate(pattern = [100]) {
            if ('vibrate' in navigator) {
                navigator.vibrate(pattern);
            }
        }

        // Banco de dados de doen√ßas e problemas expandido
        const diseaseDatabase = [
            {
                name: 'Ferrugem do Cafeeiro',
                description: 'Doen√ßa f√∫ngica causada por *Hemileia vastatrix*. Manchas amarelo-alaranjadas na face inferior das folhas, levando √† desfolha e redu√ß√£o da produtividade. Favorecida por umidade alta (>80%) e temperaturas de 20-25¬∞C.',
                treatments: [
                    { type: 'üè† Receita Caseira', name: 'Calda bordalesa (1 kg sulfato de cobre + 1 kg cal virgem em 100 L √°gua)', cost: 'R$ 8,50' },
                    { type: 'üß™ Tratamento Profissional', name: 'Fungicida tebuconazol (0.5 L/ha)', cost: 'R$ 45,00' }
                ],
                preventions: [
                    { type: 'üå± Pr√°tica Cultural', name: 'Poda para melhorar ventila√ß√£o e reduzir umidade' },
                    { type: 'üõ°Ô∏è Monitoramento', name: 'Inspe√ß√µes semanais em per√≠odos chuvosos' }
                ],
                communityCases: '4 produtores relataram casos a 2-5 km',
                communityTime: '√öltimo caso h√° 1 dia'
            },
            {
                name: 'Cercosporiose',
                description: 'Causada por *Cercospora coffeicola*. Manchas escuras com halo amarelado nas folhas e frutos, podendo causar queda prematura. Comum em umidade >70% e temperaturas de 25-30¬∞C.',
                treatments: [
                    { type: 'üè† Receita Caseira', name: 'Ch√° de cavalinha (500 g em 5 L √°gua) + √≥leo de neem (10 mL/L)', cost: 'R$ 5,20' },
                    { type: 'üß™ Tratamento Profissional', name: 'Fungicida azoxistrobina (0.3 L/ha)', cost: 'R$ 38,00' }
                ],
                preventions: [
                    { type: 'üå± Pr√°tica Cultural', name: 'Espa√ßamento adequado para ventila√ß√£o' },
                    { type: 'üõ°Ô∏è Monitoramento', name: 'Controle de irriga√ß√£o para evitar umidade excessiva' }
                ],
                communityCases: '3 produtores relataram casos a 3-6 km',
                communityTime: '√öltimo caso h√° 2 dias'
            },
            {
                name: 'Broca do Caf√©',
                description: 'Praga causada por *Hypothenemus hampei*. Pequenos orif√≠cios nos frutos, levando √† queda e perda de qualidade. Favorecida por temperaturas >20¬∞C e frutos maduros.',
                treatments: [
                    { type: 'üè† Receita Caseira', name: 'Armadilha com √°lcool et√≠lico (30%) + detergente', cost: 'R$ 12,00' },
                    { type: 'üß™ Tratamento Profissional', name: 'Inseticida endosulfan (0.4 L/ha)', cost: 'R$ 55,00' }
                ],
                preventions: [
                    { type: 'üå± Pr√°tica Cultural', name: 'Coletar frutos ca√≠dos para reduzir popula√ß√£o' },
                    { type: 'üõ°Ô∏è Monitoramento', name: 'Uso de armadilhas para monitoramento' }
                ],
                communityCases: '5 produtores relataram casos a 1-4 km',
                communityTime: '√öltimo caso h√° 12 horas'
            },
            {
                name: 'Mancha de Phoma',
                description: 'Doen√ßa f√∫ngica (*Phoma tarda*). Manchas marrons com bordas escuras nas folhas, comum em alta umidade (>80%) e sombra excessiva.',
                treatments: [
                    { type: 'üè† Receita Caseira', name: 'Solu√ß√£o de bicarbonato de s√≥dio (10 g/L) + sab√£o neutro', cost: 'R$ 3,80' },
                    { type: 'üß™ Tratamento Profissional', name: 'Fungicida oxicloreto de cobre (2 kg/ha)', cost: 'R$ 28,00' }
                ],
                preventions: [
                    { type: 'üå± Pr√°tica Cultural', name: 'Reduzir sombra com podas seletivas' },
                    { type: 'üõ°Ô∏è Monitoramento', name: 'Inspe√ß√µes ap√≥s chuvas prolongadas' }
                ],
                communityCases: '2 produtores relataram casos a 4-7 km',
                communityTime: '√öltimo caso h√° 3 dias'
            },
            {
                name: 'Antracnose',
                description: 'Doen√ßa f√∫ngica (*Colletotrichum spp.*). Manchas escuras e afundadas em frutos e folhas, prevalente em per√≠odos chuvosos com umidade >90%.',
                treatments: [
                    { type: 'üè† Receita Caseira', name: 'Extrato de alho (200 g em 5 L √°gua)', cost: 'R$ 4,00' },
                    { type: 'üß™ Tratamento Profissional', name: 'Fungicida mancozebe (2.5 kg/ha)', cost: 'R$ 35,00' }
                ],
                preventions: [
                    { type: 'üå± Pr√°tica Cultural', name: 'Remover frutos infectados do solo' },
                    { type: 'üõ°Ô∏è Monitoramento', name: 'Inspe√ß√µes frequentes em √©pocas √∫midas' }
                ],
                communityCases: '3 produtores relataram casos a 2-6 km',
                communityTime: '√öltimo caso h√° 2 dias'
            },
            {
                name: 'Bicho-Mineiro',
                description: 'Praga causada por *Leucoptera coffeella*. Pequenas minas sinuosas nas folhas, com larvas que causam desfolha. Favorecida por temperaturas quentes (>25¬∞C).',
                treatments: [
                    { type: 'üè† Receita Caseira', name: 'Solu√ß√£o de √≥leo de neem (15 mL/L)', cost: 'R$ 6,00' },
                    { type: 'üß™ Tratamento Profissional', name: 'Inseticida clorpirif√≥s (0.5 L/ha)', cost: 'R$ 40,00' }
                ],
                preventions: [
                    { type: 'üå± Pr√°tica Cultural', name: 'Remover folhas ca√≠das para reduzir popula√ß√£o' },
                    { type: 'üõ°Ô∏è Monitoramento', name: 'Inspe√ß√µes regulares nas folhas jovens' }
                ],
                communityCases: '4 produtores relataram casos a 1-5 km',
                communityTime: '√öltimo caso h√° 18 horas'
            },
            {
                name: 'Mancha Aureolada',
                description: 'Doen√ßa bacteriana (*Pseudomonas syringae*). Manchas circulares com halo amarelado nas folhas, comum em condi√ß√µes √∫midas e temperaturas moderadas (18-22¬∞C).',
                treatments: [
                    { type: 'üè† Receita Caseira', name: 'Solu√ß√£o de cobre (500 g em 100 L √°gua)', cost: 'R$ 7,00' },
                    { type: 'üß™ Tratamento Profissional', name: 'Antibi√≥tico agr√≠cola (ex.: oxitetraciclina, 0.3 kg/ha)', cost: 'R$ 50,00' }
                ],
                preventions: [
                    { type: 'üå± Pr√°tica Cultural', name: 'Evitar irriga√ß√£o por aspers√£o' },
                    { type: 'üõ°Ô∏è Monitoramento', name: 'Verificar folhas ap√≥s chuvas' }
                ],
                communityCases: '2 produtores relataram casos a 3-7 km',
                communityTime: '√öltimo caso h√° 4 dias'
            },
            {
                name: 'Ascochyta',
                description: 'Doen√ßa f√∫ngica (*Ascochyta coffeae*). Manchas escuras nas folhas, frequentemente acompanhadas de murchamento, prevalente em umidade alta (>75%).',
                treatments: [
                    { type: 'üè† Receita Caseira', name: 'Solu√ß√£o de bicarbonato de pot√°ssio (10 g/L)', cost: 'R$ 4,50' },
                    { type: 'üß™ Tratamento Profissional', name: 'Fungicida captan (2 kg/ha)', cost: 'R$ 30,00' }
                ],
                preventions: [
                    { type: 'üå± Pr√°tica Cultural', name: 'Melhorar drenagem do solo' },
                    { type: 'üõ°Ô∏è Monitoramento', name: 'Inspe√ß√µes em per√≠odos √∫midos' }
                ],
                communityCases: '1 produtor relatou caso a 5 km',
                communityTime: '√öltimo caso h√° 5 dias'
            },
            {
                name: 'Defici√™ncia de Nitrog√™nio',
                description: 'Folhas com amarelecimento generalizado, especialmente nas folhas mais velhas, devido √† falta de nitrog√™nio. Reduz o crescimento e a produtividade.',
                treatments: [
                    { type: 'üè† Receita Caseira', name: 'Composto org√¢nico rico em nitrog√™nio (10 kg/planta)', cost: 'R$ 10,00' },
                    { type: 'üß™ Tratamento Profissional', name: 'Adubo NPK 30-10-10 (300 g/planta)', cost: 'R$ 20,00' }
                ],
                preventions: [
                    { type: 'üå± Pr√°tica Cultural', name: 'Rota√ß√£o com leguminosas fixadoras de nitrog√™nio' },
                    { type: 'üõ°Ô∏è Monitoramento', name: 'An√°lise de solo anual' }
                ],
                communityCases: '3 produtores relataram casos a 2-8 km',
                communityTime: '√öltimo caso h√° 3 dias'
            },
            {
                name: 'Defici√™ncia de Pot√°ssio',
                description: 'Margens das folhas amareladas ou queimadas, com deforma√ß√£o foliar. Afeta a resist√™ncia da planta e a qualidade dos frutos.',
                treatments: [
                    { type: 'üè† Receita Caseira', name: 'Cinza de madeira (500 g/planta)', cost: 'R$ 2,00' },
                    { type: 'üß™ Tratamento Profissional', name: 'Adubo NPK 10-10-30 (250 g/planta)', cost: 'R$ 18,00' }
                ],
                preventions: [
                    { type: 'üå± Pr√°tica Cultural', name: 'Aduba√ß√£o balanceada com pot√°ssio' },
                    { type: 'üõ°Ô∏è Monitoramento', name: 'An√°lise foliar peri√≥dica' }
                ],
                communityCases: '2 produtores relataram casos a 4-6 km',
                communityTime: '√öltimo caso h√° 4 dias'
            },
            {
                name: 'Defici√™ncia de F√≥sforo',
                description: 'Folhas escuras com tons arroxeados e murchamento, devido √† falta de f√≥sforo. Impacta o desenvolvimento das ra√≠zes e frutos.',
                treatments: [
                    { type: 'üè† Receita Caseira', name: 'Farinha de osso (1 kg/planta)', cost: 'R$ 8,00' },
                    { type: 'üß™ Tratamento Profissional', name: 'Adubo NPK 10-30-10 (200 g/planta)', cost: 'R$ 15,00' }
                ],
                preventions: [
                    { type: 'üå± Pr√°tica Cultural', name: 'Aduba√ß√£o fosfatada no plantio' },
                    { type: 'üõ°Ô∏è Monitoramento', name: 'Testes de solo antes da safra' }
                ],
                communityCases: '1 produtor relatou caso a 6 km',
                communityTime: '√öltimo caso h√° 5 dias'
            },
            {
                name: 'Estresse H√≠drico',
                description: 'Folhas murchas e amareladas devido √† falta de √°gua ou irriga√ß√£o inadequada. Afeta o crescimento e a produ√ß√£o de frutos.',
                treatments: [
                    { type: 'üè† Receita Caseira', name: 'Irriga√ß√£o por gotejamento (20 L/planta/dia)', cost: 'R$ 5,00' },
                    { type: 'üß™ Tratamento Profissional', name: 'Sistema de irriga√ß√£o automatizado', cost: 'R$ 200,00' }
                ],
                preventions: [
                    { type: 'üå± Pr√°tica Cultural', name: 'Mulching para reter umidade no solo' },
                    { type: 'üõ°Ô∏è Monitoramento', name: 'Monitorar umidade do solo semanalmente' }
                ],
                communityCases: '5 produtores relataram casos a 1-7 km',
                communityTime: '√öltimo caso h√° 2 dias'
            },
            {
                name: 'Planta Saud√°vel',
                description: 'üéâ Sua planta est√° saud√°vel! Folhas e frutos sem sinais de doen√ßas, pragas ou defici√™ncias. Continue com pr√°ticas preventivas.',
                treatments: [
                    { type: 'üå± Manuten√ß√£o Preventiva', name: 'Aduba√ß√£o balanceada (NPK 20-5-20, 300 g/planta)', cost: 'R$ 15,00/m√™s' },
                    { type: 'üß™ Preven√ß√£o Avan√ßada', name: 'Programa de manejo integrado', cost: 'R$ 85,00/m√™s' }
                ],
                preventions: [
                    { type: 'üå± Pr√°tica Cultural', name: 'Rota√ß√£o de culturas e poda regular' },
                    { type: 'üõ°Ô∏è Monitoramento', name: 'Verifica√ß√µes mensais para pragas e doen√ßas' }
                ],
                communityCases: 'Nenhum caso de problema na regi√£o',
                communityTime: 'Atualizado hoje'
            }
        ];

        // Atualiza√ß√£o din√¢mica da comunidade
        function updateCommunityData() {
            const problems = diseaseDatabase.map(d => d.name).filter(d => d !== 'Planta Saud√°vel');
            setInterval(() => {
                if (Math.random() < 0.1) {
                    const newCase = {
                        name: `Produtor ${Math.floor(Math.random() * 1000)}`,
                        problem: problems[Math.floor(Math.random() * problems.length)],
                        distance: (Math.random() * 8 + 0.5).toFixed(1) + 'km'
                    };
                    console.log('üÜï Novo caso na comunidade:', newCase);
                }
            }, 15000);
        }

        // Easter eggs
        let clickCount = 0;
        document.querySelector('.logo').addEventListener('click', () => {
            clickCount++;
            if (clickCount === 5) {
                alert(`üéâ Modo desenvolvedor ativado!\n\nüìä Estat√≠sticas:\n‚Ä¢ An√°lises processadas: ${analysisCount}\n‚Ä¢ Usu√°rios ativos: ${userCount}\n‚Ä¢ Precis√£o m√©dia: 96%\n‚Ä¢ √öltima atualiza√ß√£o: ${new Date().toLocaleString()}`);
                clickCount = 0;
            }
        });

        // Simula√ß√£o de notifica√ß√µes push peri√≥dicas
        setInterval(() => {
            if (Math.random() < 0.1 && 'Notification' in window && Notification.permission === 'granted') {
                const alerts = [
                    'Novo surto de ferrugem detectado a 3km',
                    'Condi√ß√µes favor√°veis para cercosporiose',
                    '5 produtores trataram broca com sucesso',
                    'Alerta: chuvas podem favorecer antracnose',
                    'Bicho-mineiro detectado a 2km'
                ];
                
                const randomAlert = alerts[Math.floor(Math.random() * alerts.length)];
                
                new Notification('üö® AgroSOS - Alerta Regional', {
                    body: randomAlert,
                    icon: 'üå±',
                    requireInteraction: false
                });
            }
        }, 30000);

        // Funcionalidade de compartilhamento
        function shareResult(result) {
            if (navigator.share) {
                navigator.share({
                    title: 'AgroSOS - Diagn√≥stico',
                    text: `Diagnostiquei ${result.name} com ${result.confidence}% de confian√ßa usando o AgroSOS!`,
                    url: 'https://agrosos.com.br'
                });
            }
        }

        // Modo escuro/claro
        function toggleTheme() {
            document.body.classList.toggle('dark-theme');
        }

        // Salvamento autom√°tico de prefer√™ncias
        function savePreferences() {
            const prefs = {
                notifications: true,
                offlineMode: true,
                language: 'pt-BR',
                theme: document.body.classList.contains('dark-theme') ? 'dark' : 'auto'
            };
            localStorage.setItem('agroSosPrefs', JSON.stringify(prefs));
        }

        // Carregar prefer√™ncias
        function loadPreferences() {
            const prefs = JSON.parse(localStorage.getItem('agroSosPrefs') || '{}');
            if (prefs.theme === 'dark') {
                document.body.classList.add('dark-theme');
            }
            return prefs;
        }

        // Inicializar app
        document.addEventListener('DOMContentLoaded', () => {
            updateOnlineStatus();
            loadPreferences();
            savePreferences();
            loadHistory();
            updateCommunityData();
            
            document.querySelectorAll('button').forEach(btn => {
                btn.addEventListener('click', () => {
                    vibrate([50]);
                    playSound('click');
                });
            });
            
            document.querySelector('.container').classList.add('fade-in');
            
            // Exibir mensagem de boas-vindas na primeira visita
            if (!localStorage.getItem('agroSosFirstVisit')) {
                setTimeout(() => {
                    alert('üëã Bem-vindo ao AgroSOS!\n\nüì∏ Dica: Foque em folhas ou frutos com boa ilumina√ß√£o para an√°lises precisas!\n\nüå± Identificamos problemas em cafezais e sugerimos tratamentos econ√¥micos.');
                    localStorage.setItem('agroSosFirstVisit', 'true');
                }, 1000);
            }
        });
    </script>
</body>
</html>