<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.21.0/dist/tf.min.js"></script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AgroSOS - Assistente AgrÃ­cola Inteligente</title>
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiQWdyb1NPUyIsInNob3J0X25hbWUiOiJBZ3JvU09TIiwic3RhcnRfdXJsIjoiLyIsImRpc3BsYXkiOiJzdGFuZGFsb25lIiwiYmFja2dyb3VuZF9jb2xvciI6IiMyMjc3M2QiLCJ0aGVtZV9jb2xvciI6IiMyMjc3M2QifQ==">
    <meta name="theme-color" content="#22773d">
    <link rel="stylesheet" href="../styles.css">
 
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="logo">
                <div class="logo-icon">ğŸŒ±</div>
                <h1>AgroSOS</h1>
            </div>
            <div class="tagline">Seu assistente para cafezais saudÃ¡veis</div>
        </div>

        <!-- Offline Indicator -->
        <div class="offline-indicator" id="offlineIndicator" style="display: none;">
            ğŸ“± Modo Offline Ativo - IA funcionando localmente
        </div>

        <!-- Home Screen -->
        <div class="screen active" id="homeScreen">
            <!-- Stats -->
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-number" id="analysisCount">1,247</div>
                    <div class="stat-label">AnÃ¡lises hoje</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">96%</div>
                    <div class="stat-label">PrecisÃ£o da IA</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">R$ 150</div>
                    <div class="stat-label">Economia mÃ©dia</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="userCount">12.5K</div>
                    <div class="stat-label">Produtores ativos</div>
                </div>
            </div>

            <!-- Main Actions -->
            <div class="main-actions">
                <button class="analyze-btn" onclick="openCamera()" aria-label="Iniciar anÃ¡lise de planta">
                    ğŸ“¸ Analisar Planta
                </button>
                
                <div class="secondary-actions">
                    <button class="secondary-btn" onclick="showScreen('communityScreen')" aria-label="Ver mapa regional">
                        ğŸ—ºï¸ Mapa Regional
                    </button>
                    <button class="secondary-btn" onclick="showScreen('historyScreen')" aria-label="Ver histÃ³rico de anÃ¡lises">
                        ğŸ“‹ HistÃ³rico
                    </button>
                </div>
            </div>

            <!-- Recent Alerts -->
            <div style="padding: 0 20px;">
                <h3 style="margin-bottom: 15px;">âš ï¸ Alertas na RegiÃ£o</h3>
                <div class="alert-item">
                    <strong>Ferrugem do Cafeeiro</strong><br>
                    <small>3 casos reportados em um raio de 5km</small>
                    <div class="distance">2.3km de distÃ¢ncia</div>
                </div>
                <div class="alert-item">
                    <strong>Broca do CafÃ©</strong><br>
                    <small>Surto ativo - 8 propriedades afetadas</small>
                    <div class="distance">4.7km de distÃ¢ncia</div>
                </div>
            </div>
        </div>

        <!-- Community Screen -->
        <div class="screen" id="communityScreen">
            <h2 style="margin-bottom: 20px;">ğŸŒ Comunidade Regional</h2>
            
            <div class="map-container">
                <div class="map-pin" style="top: 20%; left: 30%;"></div>
                <div class="map-pin" style="top: 60%; left: 70%;"></div>
                <div class="map-pin" style="top: 40%; left: 45%;"></div>
                <div class="map-pin" style="top: 80%; left: 20%;"></div>
                <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: rgba(255,255,255,0.7);">
                    RegiÃ£o de Minas Gerais<br>
                    <small>4 surtos ativos detectados</small>
                </div>
            </div>

            <div class="community-section">
                <h4>Casos Recentes (Ãºltimas 24h)</h4>
                <div class="community-item">
                    <div>ğŸ”´</div>
                    <div>
                        <strong>JoÃ£o Silva</strong> - Ferrugem severa<br>
                        <small>Fazenda SÃ£o JosÃ©</small>
                    </div>
                    <div class="distance">1.2km</div>
                </div>
                <div class="community-item">
                    <div>ğŸŸ¡</div>
                    <div>
                        <strong>Maria Santos</strong> - Cercosporiose<br>
                        <small>SÃ­tio Boa Vista</small>
                    </div>
                    <div class="distance">3.5km</div>
                </div>
                <div class="community-item">
                    <div>ğŸ”´</div>
                    <div>
                        <strong>Pedro Costa</strong> - Broca ativa<br>
                        <small>Fazenda EsperanÃ§a</small>
                    </div>
                    <div class="distance">5.1km</div>
                </div>
            </div>
        </div>

        <!-- History Screen -->
        <div class="screen" id="historyScreen">
            <h2 style="margin-bottom: 20px;">ğŸ“‹ Seu HistÃ³rico</h2>
            
            <div class="history-item">
                <div>
                    <strong>Ferrugem do Cafeeiro</strong><br>
                    <small>TalhÃ£o 3 - Tratado com sucesso</small><br>
                    <small style="opacity: 0.7;">HÃ¡ 3 dias</small>
                </div>
                <div style="color: #22c55e;">âœ…</div>
            </div>
            
            <div class="history-item">
                <div>
                    <strong>Planta SaudÃ¡vel</strong><br>
                    <small>TalhÃ£o 1 - Sem problemas detectados</small><br>
                    <small style="opacity: 0.7;">HÃ¡ 1 semana</small>
                </div>
                <div style="color: #22c55e;">âœ…</div>
            </div>
            
            <div class="history-item">
                <div>
                    <strong>Cercosporiose</strong><br>
                    <small>TalhÃ£o 2 - Em tratamento</small><br>
                    <small style="opacity: 0.7;">HÃ¡ 2 semanas</small>
                </div>
                <div style="color: #f59e0b;">ğŸ”„</div>
            </div>

            <div style="margin-top: 30px; text-align: center; opacity: 0.7;">
                <p>Economia total: <strong style="color: #22c55e;">R$ 450,00</strong></p>
                <p>Versus consultoria tradicional</p>
            </div>
        </div>

        <!-- Camera Choice Modal -->
        <div class="modal" id="cameraModal">
            <div class="modal-content">
                <button class="close-btn" onclick="closeModal()" aria-label="Fechar modal">&times;</button>
                <h3>ğŸ“¸ Analisar Planta</h3>
                <p>Escolha como fornecer a imagem da planta:</p>
                
                <div style="display: flex; flex-direction: column; gap: 15px; margin: 20px 0;">
                    <button class="capture-btn" onclick="openCameraStream()" style="width: 100%; border-radius: 10px; padding: 15px;" aria-label="Usar cÃ¢mera para capturar imagem">
                        ğŸ“· Usar CÃ¢mera
                    </button>
                    <button class="capture-btn" onclick="triggerFileUpload()" style="width: 100%; border-radius: 10px; padding: 15px;" aria-label="Fazer upload de imagem">
                        ğŸ“¤ Fazer Upload
                    </button>
                </div>
                
                <!-- Hidden file input for uploads -->
                <input type="file" id="imageUpload" accept="image/*" style="display: none;" onchange="handleFileUpload(event)">
                
                <p style="font-size: 12px; opacity: 0.7; margin-top: 10px;">
                    Dica: Fotografe folhas ou frutos com boa iluminaÃ§Ã£o, fundo limpo e foco nÃ­tido.
                </p>
            </div>
        </div>

        <!-- Camera Stream Modal -->
        <div class="modal" id="cameraStreamModal">
            <div class="modal-content">
                <button class="close-btn" onclick="closeModal()" aria-label="Fechar modal">&times;</button>
                <h3>ğŸ“¸ Fotografar Planta</h3>
                <p>Centralize a folha ou fruto no quadro verde</p>
                
                <div class="camera-preview">
                    <video id="cameraVideo" autoplay playsinline style="width: 100%; height: 100%; object-fit: cover;"></video>
                    <canvas id="cameraCanvas" style="display: none;"></canvas>
                    <div class="camera-overlay"></div>
                </div>
                
                <button class="capture-btn" onclick="capturePhotoFromCamera()" aria-label="Capturar foto">ğŸ“¸</button>
                <p style="font-size: 12px; opacity: 0.7; margin-top: 10px;">
                    Evite sombras, mantenha a cÃ¢mera estÃ¡vel e use luz natural.
                </p>
            </div>
        </div>

        <!-- Analysis Modal -->
        <div class="modal" id="analysisModal">
            <div class="modal-content">
                <h3>ğŸ¤– Analisando...</h3>
                <div class="loading"></div>
                <p>Processando imagem com IA avanÃ§ada</p>
                <p style="font-size: 12px; opacity: 0.7;">Isso leva alguns segundos</p>
            </div>
        </div>

        <!-- Result Modal -->
        <div class="modal result-modal" id="resultModal">
            <div class="modal-content">
                <button class="close-btn" onclick="closeModal()" aria-label="Fechar modal">&times;</button>
                <h3>ğŸ¯ DiagnÃ³stico Completo</h3>
                <img id="analyzedImage" class="image-preview" style="display: none;" alt="Imagem analisada">
                
                <div class="disease-info">
                    <h4 id="diseaseName"></h4>
                    <div class="confidence" id="confidence"></div>
                    <p style="margin-top: 10px; opacity: 0.9;" id="diseaseDescription"></p>
                    <p class="warning" id="imageQualityWarning" style="display: none;"></p>
                </div>

                <div class="treatment-section">
                    <h4>ğŸ’Š Tratamentos Recomendados</h4>
                    <div id="treatments"></div>
                </div>

                <div class="prevention-section">
                    <h4>ğŸ›¡ï¸ PrevenÃ§Ã£o</h4>
                    <div id="preventions"></div>
                </div>

                <div class="community-section">
                    <h4>ğŸ‘¥ Outros Casos na RegiÃ£o</h4>
                    <div class="community-item">
                        <div>ğŸ“</div>
                        <div id="communityCases"></div>
                    </div>
                    <div class="community-item">
                        <div>â°</div>
                        <div id="communityTime"></div>
                    </div>
                </div>

                <button class="analyze-btn" onclick="closeModal()" style="margin-top: 20px;" aria-label="Fechar resultado">
                    ğŸšª Fechar
                </button>
                <button class="secondary-btn" onclick="openCamera()" style="margin-top: 10px; display: none;" id="retryButton" aria-label="Tentar novamente">
                    ğŸ“¸ Tentar Novamente
                </button>
            </div>
        </div>

        <!-- Navigation -->
        <div class="navigation">
            <div class="nav-item active" onclick="showScreen('homeScreen')" aria-label="Ir para tela inicial">
                <div class="nav-icon">ğŸ </div>
                <div class="nav-label">InÃ­cio</div>
            </div>
            <div class="nav-item" onclick="openCamera()" aria-label="Analisar planta">
                <div class="nav-icon">ğŸ“¸</div>
                <div class="nav-label">Analisar</div>
            </div>
            <div class="nav-item" onclick="showScreen('communityScreen')" aria-label="Ver comunidade">
                <div class="nav-icon">ğŸ—ºï¸</div>
                <div class="nav-label">Comunidade</div>
            </div>
            <div class="nav-item" onclick="showScreen('historyScreen')" aria-label="Ver histÃ³rico">
                <div class="nav-icon">ğŸ“‹</div>
                <div class="nav-label">HistÃ³rico</div>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.12.0/dist/tf.min.js"></script>
    <script src="../ai-model/script.js"></script>
    
</body>
</html>